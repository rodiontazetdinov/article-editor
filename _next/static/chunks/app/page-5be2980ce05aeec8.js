(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4971:function(e,t,n){Promise.resolve().then(n.bind(n,1876))},1876:function(e,t,n){"use strict";n.d(t,{ArticleEditor:function(){return ej}});var r=n(7437),l=n(2265),a=n(3619),s=n(5015),o=n(9512),i=n(3971),c=n(5318),d=n(8234),u=n(4725),p=n(7213),g=n(808),m=n(144),h=n(4887);n(2446);let x=e=>e.replace(/\\left\s*{/g,"\\left\\{").replace(/\\right\s*}/g,"\\right\\}").replace(/\\left\s*\(/g,"\\left(").replace(/\\right\s*\)/g,"\\right)").replace(/\\left\s*\[/g,"\\left[").replace(/\\right\s*\]/g,"\\right]").replace(/\\overset\s*{/g,"\\overset{").replace(/\\overset\s*{\\overline}/g,"\\overline").replace(/\\overset\s*{\\cdot}/g,"\\dot").replace(/exp\s*⁡/g,"\\exp").replace(/\\alpha\s+\\overset/g,"\\alpha\\overset").replace(/\\beta\s+\\right/g,"\\beta\\right").replace(/\\sigma\s+\\alpha/g,"\\sigma\\alpha").replace(/\s+/g," ").trim(),f=u.NB.create({name:"formula",group:"inline",inline:!0,atom:!0,addAttributes:()=>({content:{default:""}}),parseHTML:()=>[{tag:'span[data-type="formula"]',getAttrs:e=>"string"==typeof e?{}:{content:e.getAttribute("data-formula")}}],renderHTML(e){let{HTMLAttributes:t}=e;return["span",{"data-type":"formula","data-formula":t.content,class:"inline-formula"}]},addNodeView:()=>e=>{let{node:t,editor:n}=e,r=document.createElement("span");r.style.display="inline-block",r.style.verticalAlign="middle",r.style.padding="0 4px",r.style.margin="0 1px",r.style.backgroundColor="rgba(232, 244, 253, 0.8)",r.style.borderRadius="4px",r.style.border="1px solid rgba(187, 222, 251, 0.5)",r.style.transition="all 0.2s ease-in-out",r.style.cursor="pointer",r.style.minWidth="20px",r.style.minHeight="24px",r.className="inline-formula";let a=document.createElement("div");a.style.position="fixed",a.style.zIndex="1000",a.style.top="0",a.style.left="0",document.body.appendChild(a);let s=!1,o=e=>{try{let t=e.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/\\\\/g,"\\"),n=x(t),a=r.offsetWidth,s=r.offsetHeight;for(;r.firstChild;)r.removeChild(r.firstChild);let o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.minWidth="".concat(Math.max(a,20),"px"),o.style.minHeight="".concat(Math.max(s,24),"px"),r.appendChild(o),h.render(l.createElement(m.InlineMath,{math:n,errorColor:"#e53e3e",renderError:e=>(console.error("KaTeX error:",e),l.createElement("span",{style:{color:"#e53e3e",cursor:"help",borderBottom:"1px dotted #e53e3e"},title:e.message},"$".concat(t,"$")))}),o)}catch(t){console.error("Error rendering formula:",t),r.innerHTML='<span style="color: #e53e3e; cursor: help; border-bottom: 1px dotted #e53e3e" title="'.concat(t instanceof Error?t.message:"Unknown error",'">').concat(e,"</span>"),r.style.backgroundColor="rgba(254, 242, 242, 0.8)",r.style.border="1px solid rgba(252, 165, 165, 0.5)"}},i=e=>{let{content:t,onSave:n,onCancel:r}=e,[a,s]=l.useState(t),o=l.useRef(null);return l.useEffect(()=>{o.current&&o.current.focus()},[]),l.createElement("div",{style:{position:"absolute",backgroundColor:"white",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",borderRadius:"6px",padding:"8px",width:"300px"}},[l.createElement("textarea",{key:"textarea",ref:o,value:a,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.shiftKey?(e.preventDefault(),n(a)):"Escape"===e.key&&(e.preventDefault(),r())},style:{width:"100%",minHeight:"60px",padding:"8px",border:"1px solid #e2e8f0",borderRadius:"4px",backgroundColor:"#f8fafc",fontFamily:"monospace",fontSize:"14px",resize:"vertical",marginBottom:"8px"}}),l.createElement("div",{key:"preview",style:{padding:"8px",backgroundColor:"#f8fafc",borderRadius:"4px",marginBottom:"8px",minHeight:"30px"}},l.createElement(m.InlineMath,{math:x(a)})),l.createElement("div",{key:"buttons",style:{display:"flex",gap:"8px"}},[l.createElement("button",{key:"save",onClick:()=>n(a),style:{backgroundColor:"#4299e1",color:"white",padding:"4px 12px",borderRadius:"4px",fontSize:"14px",cursor:"pointer",border:"none"}},"Сохранить"),l.createElement("button",{key:"cancel",onClick:r,style:{backgroundColor:"#e2e8f0",color:"#4a5568",padding:"4px 12px",borderRadius:"4px",fontSize:"14px",cursor:"pointer",border:"none"}},"Отмена")])])},c=()=>{s&&(s=!1,h.unmountComponentAtNode(a))};return r.addEventListener("click",()=>{if(s)return;s=!0;let e=r.getBoundingClientRect();a.style.left="".concat(e.left,"px"),a.style.top="".concat(e.bottom+4,"px");let d=e=>{c(),n.commands.updateAttributes(t.type.name,{content:e}),requestAnimationFrame(()=>{o(e)})};document.addEventListener("mousedown",e=>{let t=e.target;if(t instanceof Element&&!a.contains(t)&&!r.contains(t)){let e=a.querySelector("textarea");e?d(e.value):c()}}),h.render(l.createElement(i,{content:t.attrs.content||"",onSave:d,onCancel:()=>{c()}}),a)}),r.addEventListener("mouseenter",()=>{s||(r.style.backgroundColor="rgba(187, 222, 251, 0.3)",r.style.border="1px solid rgba(187, 222, 251, 0.8)")}),r.addEventListener("mouseleave",()=>{s||(r.style.backgroundColor="rgba(232, 244, 253, 0.8)",r.style.border="1px solid rgba(187, 222, 251, 0.5)")}),o(t.attrs.content||""),{dom:r,update:e=>e.type===t.type&&(t=e,s||setTimeout(()=>{o(e.attrs.content||"")},0),!0),destroy:()=>{h.unmountComponentAtNode(r),a.parentNode&&a.parentNode.removeChild(a)}}},addCommands(){return{setFormula:e=>t=>{let{chain:n}=t;return n().focus().insertContent([{type:this.name,attrs:{content:e}}]).run()}}}}),y=e=>e.replace(/\$(.*?)\$/g,(e,t)=>{let n=t.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").trim();return'<span data-type="formula" data-formula="'.concat(n,'"></span>')}),b=e=>{var t;let{block:n,onUpdate:a,activeFormats:m,onActiveFormatsChange:h,onEnterPress:x,onDelete:b,onAdd:v,shouldFocus:w,onSelect:j,onFormulaClick:N,onDeepSeekConvert:k}=e,S=(0,l.useRef)(null),C=(0,l.useRef)(null),E=(e,t)=>{let{$from:n}=e.selection,r=n.depth;for(;r>0;){if(n.node(r).type.name===t)return!0;r--}return!1},A=(0,s.jE)({extensions:[o.Z.configure({bold:!1,heading:{levels:[1,2,3]},bulletList:{HTMLAttributes:{class:"list-disc ml-4 space-y-1"}},orderedList:{HTMLAttributes:{class:"list-decimal ml-4 space-y-1"}},paragraph:{HTMLAttributes:{class:"leading-relaxed"}}}),g.ZP.configure({HTMLAttributes:{class:"font-bold"}}),i.Z,d.Z,c.Z.configure({types:["heading","paragraph"]}),f.configure({HTMLAttributes:{class:"formula-node"}}),u.hj.create({name:"customFormula",addCommands:()=>({wrapInFormula:()=>e=>{let{state:t,chain:n}=e,{from:r,to:l}=t.selection,a=t.doc.textBetween(r,l);return console.log("wrapInFormula command called with text:",a),!!a&&n().focus().insertContent("$".concat(a,"$")).run()},convertWithDeepSeek:()=>e=>{let{state:t,chain:n}=e,{from:r,to:l}=t.selection,a=t.doc.textBetween(r,l);return console.log("convertWithDeepSeek command called with text:",a),!!a&&!!k&&(k(),!0)}})}),u.hj.create({name:"preserveSelection",addProseMirrorPlugins:()=>[new p.Sy({key:new p.H$("preserveSelection"),props:{handleDOMEvents:{mousedown:(e,t)=>{let n=t.target;return console.log("mousedown on element:",n),!!n.closest(".toolbar-button")&&(console.log("Clicked on toolbar button, preventing default"),t.preventDefault(),!0)}}}})]})],content:y(n.content),onUpdate:e=>{let{editor:t}=e;a({content:t.getHTML().replace(/<li>\s*<p><\/p>\s*<\/li>/g,"").replace(/<((ul|ol)[^>]*)>\s*<\/\2>/g,"").replace(/<span data-type="formula" data-formula="(.*?)"[^>]*><\/span>/g,(e,t)=>"$".concat(t,"$"))})},onSelectionUpdate:e=>{let{editor:t}=e;h&&h({bold:t.isActive("bold"),italic:t.isActive("italic"),underline:t.isActive("underline"),superscript:t.isActive("superscript")});let{from:r,to:l}=t.state.selection,a=t.state.doc.textBetween(r,l);console.log("Selection update:",{hasText:!!a,text:a,from:r,to:l,selection:t.state.selection,block:n.id}),a&&j&&(console.log("Calling onSelect with:",{text:a,startOffset:r,endOffset:l}),j({text:a,startOffset:r,endOffset:l}))},editorProps:{attributes:{class:(e=>{switch(e){case"H1":return"text-4xl font-bold tracking-tight";case"H2":return"text-3xl font-bold tracking-tight";case"H3":return"text-2xl font-bold tracking-tight";case"P":return"text-lg leading-relaxed";case"CAPTION":return"text-sm text-gray-600 italic";default:return""}})(n.type)},handleKeyDown:(e,t)=>{if("Enter"===t.key&&!t.shiftKey){let{$from:n}=e.state.selection;if(!(E(e.state,"bulletList")||E(e.state,"orderedList")))return t.preventDefault(),null==x||x(),!0;if(""===n.parent.textContent.trim())return t.preventDefault(),null==A||A.chain().focus().liftListItem("listItem").run(),null==x||x(),!0}return!1}}});return((0,l.useEffect)(()=>{A&&(S.current=A,C.current&&(C.current.__tiptapEditor=A))},[A]),(0,l.useEffect)(()=>{let e=S.current;if(e&&n.content){let t=y(n.content);t!==e.getHTML()&&e.commands.setContent(t)}},[n.content]),(0,l.useEffect)(()=>{let e=S.current;e&&m&&(m.bold!==e.isActive("bold")&&e.chain().focus().toggleBold().run(),m.italic!==e.isActive("italic")&&e.chain().focus().toggleItalic().run(),m.underline!==e.isActive("underline")&&e.chain().focus().toggleUnderline().run(),m.superscript!==e.isActive("superscript")&&e.chain().focus().toggleSuperscript().run())},[m]),(0,l.useEffect)(()=>{let e=S.current;e&&n.listType&&("ordered"===n.listType?e.chain().focus().toggleOrderedList().run():"unordered"===n.listType&&e.chain().focus().toggleBulletList().run())},[n.listType]),(0,l.useEffect)(()=>{let e=S.current;e&&n.align&&e.chain().focus().setTextAlign(n.align).run()},[n.align]),(0,l.useEffect)(()=>{let e=S.current;e&&w&&e.commands.focus("end")},[w]),(0,l.useEffect)(()=>{let e=S.current;if(e){let t=document.querySelector('[data-block-id="'.concat(n.id,'"] .ProseMirror'));t&&(t.__editor=e)}},[n.id]),A)?(0,r.jsx)("div",{ref:C,className:"prose max-w-none focus-within:outline-none ".concat("uppercase"===n.textCase?"uppercase":""," \n        ").concat("lowercase"===n.textCase?"lowercase":""," \n        ").concat("capitalize"===n.textCase?"capitalize":""),style:{paddingLeft:"".concat(null!==(t=n.indent)&&void 0!==t?t:0,"rem"),transition:"all 0.2s ease-in-out"},"data-block-id":n.id,children:(0,r.jsx)(s.kg,{editor:A})}):null};var v=n(29),w=n.n(v);let j=e=>{let{block:t,onUpdate:n}=e,[a,s]=(0,l.useState)(!1),o=e=>e.replace(/\\left\s*{/g,"\\left\\{").replace(/\\right\s*}/g,"\\right\\}").replace(/\\left\s*\(/g,"\\left(").replace(/\\right\s*\)/g,"\\right)").replace(/\\left\s*\[/g,"\\left[").replace(/\\right\s*\]/g,"\\right]").replace(/\\overset\s*{/g,"\\overset{").replace(/\\overset\s*{\\overline}/g,"\\overline").replace(/\\overset\s*{\\cdot}/g,"\\dot").replace(/exp\s*⁡/g,"\\exp").replace(/\\alpha\s+\\overset/g,"\\alpha\\overset").replace(/\\beta\s+\\right/g,"\\beta\\right").replace(/\\sigma\s+\\alpha/g,"\\sigma\\alpha").replace(/\s+/g," ").trim(),{formula:i,number:c}=(e=>{if(e.includes("#")){let[t,n]=e.split("#").map(e=>e.trim()),r=n.replace(/[()]/g,"").trim();return{formula:o(t),number:r}}return{formula:o(e),number:null}})(t.content);return(0,r.jsx)("div",{className:"w-full",children:a?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("textarea",{value:t.content,onChange:e=>{let r=e.target.value,l=t.changes||[];if(t.content&&t.content!==r){let e={position:0,before:t.content,after:r};n({content:r,changes:[...l,e]})}else n({content:r})},className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введите LaTeX формулу",rows:2,autoFocus:!0,onBlur:()=>s(!1),onKeyDown:e=>{"Enter"===e.key&&e.shiftKey&&(e.preventDefault(),s(!1))}}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Нажмите Shift + Enter или кликните вне поля для сохранения"})]}):(0,r.jsxs)("div",{onClick:()=>s(!0),className:"jsx-345c0dec742c450c formula-container cursor-pointer hover:bg-gray-50/50 transition-colors rounded p-4",children:[(0,r.jsx)(w(),{id:"345c0dec742c450c",children:".formula-container{display:grid;grid-template-columns:1fr auto;gap:2rem;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;width:100%;overflow:hidden}.formula-container .formula{overflow-x:auto;overflow-y:hidden;margin:0;scrollbar-width:none;-ms-overflow-style:none}.formula-container .formula::-webkit-scrollbar{display:none}.formula-container .formula .katex-display{margin:0;padding:0}.formula-container .formula .katex-display>.katex{white-space:nowrap}.formula-container .number{font-size:1.2em;color:#333;white-space:nowrap}"}),(0,r.jsx)("div",{className:"jsx-345c0dec742c450c formula",children:(0,r.jsx)(m.BlockMath,{math:i||" "})}),c&&(0,r.jsxs)("div",{className:"jsx-345c0dec742c450c number",children:["(",c,")"]})]})})};var N=n(3145);let k=e=>{let{block:t,onUpdate:n}=e,l=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){let e=URL.createObjectURL(r);n({src:e,content:e})}},a=t.src||t.content||"";return(0,r.jsxs)("div",{className:"w-full space-y-2",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:l,className:"w-full p-2"}),a&&(0,r.jsx)("div",{className:"relative w-full h-[300px]",children:(0,r.jsx)(N.default,{src:a,alt:"Uploaded image",fill:!0,className:"object-contain"})})]})};var S=n(2744);let C=/\$([^$]+)\$/g,E=/\s+class="[^"]*"/g,A=/\s+style="[^"]*"/g,T=/\s+data-[^=]+=("[^"]*"|'[^']*')/g,O=/<([^>]+)>\s*<\/\1>/g,L=/\s+/g,I=/\n\s*\n/g,M=/<li[^>]*>(?:\s*<p[^>]*>\s*<\/p>\s*|\s*)<\/li>/g,$=/<(ul|ol)[^>]*>(?:\s*<li[^>]*>(?:\s*<p[^>]*>\s*<\/p>\s*|\s*)<\/li>\s*)*<\/\1>/g,H=new Set(["strong","em","u","a","br","sup","sub","ul","ol","li"]);function P(e){if("content"in e&&e.content){let t=!!("P"===e.type&&"listType"in e&&e.listType),n=e.content;if(!(n=n.replace(M,"").replace($,"")).trim()){let{listType:t,...n}=e;return{...n,content:"<p></p>"}}return{...e,content:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)return e.replace(M,"").replace($,"");let n=[],r=(e=e.replace(M,"").replace($,"").replace(C,e=>(n.push(e),"__FORMULA".concat(n.length-1,"__")))).replace(E,"").replace(A,"").replace(T,"").replace(O,"").replace(L," ").replace(I,"\n"),l=document.createElement("div");l.innerHTML=r;let a=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,null),s=[],o=a.nextNode();for(;o;)s.push(o),o=a.nextNode();return s.reverse().forEach(function(e){if(e.nodeType===Node.ELEMENT_NODE){let n=e.tagName.toLowerCase();if(!H.has(n)){var t;let n=document.createDocumentFragment();for(;e.firstChild;){let t=e.firstChild;n.appendChild(t)}null===(t=e.parentNode)||void 0===t||t.replaceChild(n,e)}}}),(r=l.innerHTML.replace(/__FORMULA(\d+)__/g,(e,t)=>n[parseInt(t)])).trim()}(n,t)}}return e}let D=e=>{let{blocks:t}=e,[n,a]=(0,l.useState)(!1),s=e=>{let t=[e].map(P)[0],n={type:t.type,content:"content"in t?t.content:"",indent:t.indent||0,id:t.id,modified:t.modified};return"FORMULA"===t.type?{...n,isInline:"inline"in t&&t.inline}:"IMAGE"===t.type?{...n,variant:"variant"in t?t.variant:"1",images:"images"in t?t.images:[],src:"src"in t?t.src:""}:n};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>a(!n),className:"bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full shadow-lg transition-all hover:scale-105",title:"Показать JSON",children:(0,r.jsx)(S.xoN,{className:"w-6 h-6"})}),n&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Предпросмотр JSON"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{let e=JSON.stringify(t.map(s),null,2);navigator.clipboard.writeText(e)},className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors",children:"Копировать"}),(0,r.jsx)("button",{onClick:()=>{let e=new Blob([JSON.stringify(t.map(s),null,2)],{type:"application/json"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download="article.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)},className:"px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded transition-colors",children:"Скачать"}),(0,r.jsx)("button",{onClick:()=>a(!1),className:"px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded transition-colors",children:"Закрыть"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-auto p-4",children:(0,r.jsx)("pre",{className:"bg-gray-50 p-4 rounded-lg text-sm font-mono whitespace-pre-wrap",children:JSON.stringify(t.map(s),null,2)})})]})})]})},F=e=>e.replace(/\\left\s*{/g,"\\left\\{").replace(/\\right\s*}/g,"\\right\\}").replace(/\\left\s*\(/g,"\\left(").replace(/\\right\s*\)/g,"\\right)").replace(/\\left\s*\[/g,"\\left[").replace(/\\right\s*\]/g,"\\right]").replace(/\\overset\s*{/g,"\\overset{").replace(/\\overset\s*{\\overline}/g,"\\overline").replace(/\\overset\s*{\\cdot}/g,"\\dot").replace(/exp\s*⁡/g,"\\exp").replace(/\\alpha\s+\\overset/g,"\\alpha\\overset").replace(/\\beta\s+\\right/g,"\\beta\\right").replace(/\\sigma\s+\\alpha/g,"\\sigma\\alpha").replace(/\s+/g," ").trim(),_=e=>{let{blocks:t}=e,n=e=>{switch(e.type){case"H1":return(0,r.jsx)("h1",{className:"text-4xl font-bold mb-6 mt-8",dangerouslySetInnerHTML:{__html:e.content||""}});case"H2":return(0,r.jsx)("h2",{className:"text-3xl font-bold mb-4 mt-6",dangerouslySetInnerHTML:{__html:e.content||""}});case"H3":return(0,r.jsx)("h3",{className:"text-2xl font-bold mb-3 mt-5",dangerouslySetInnerHTML:{__html:e.content||""}});case"P":let t=e.content.split(/(\$.*?\$)/g);return(0,r.jsx)("p",{className:"text-lg mb-4 leading-relaxed",children:t.map((e,t)=>{if(!(e.startsWith("$")&&e.endsWith("$")))return(0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:e}},t);{let n=F(e.slice(1,-1));return(0,r.jsx)(m.InlineMath,{math:n,errorColor:"#e53e3e",renderError:t=>(console.error("KaTeX error:",t),(0,r.jsxs)("span",{style:{color:"#e53e3e",cursor:"help",borderBottom:"1px dotted #e53e3e"},title:t.message,children:["$",e.slice(1,-1),"$"]}))},t)}})});case"CAPTION":return(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4 italic",dangerouslySetInnerHTML:{__html:e.content||""}});case"IMAGE":return e.src?(0,r.jsx)("div",{className:"my-6",children:(0,r.jsx)("div",{className:"relative w-full h-[400px]",children:(0,r.jsx)(N.default,{src:e.src,alt:"Article image",fill:!0,className:"object-contain"})})}):null;case"FORMULA":let[n,l]=(e.content||"").split("#").map(e=>e.trim()),a=null==l?void 0:l.replace(/[()]/g,"").trim();return(0,r.jsxs)("div",{className:"my-6 flex justify-center items-center gap-4",children:[(0,r.jsx)(m.BlockMath,{math:F(n),errorColor:"#e53e3e",renderError:e=>(console.error("KaTeX error:",e),(0,r.jsx)("div",{style:{color:"#e53e3e",cursor:"help",borderBottom:"1px dotted #e53e3e",padding:"1rem"},title:e.message,children:n}))}),a&&(0,r.jsxs)("div",{className:"text-lg text-gray-600",children:["(",a,")"]})]});default:return null}};return(0,r.jsx)("article",{className:"max-w-4xl mx-auto px-6 py-8 bg-white",children:t.map(e=>{var t;return(0,r.jsx)("div",{className:e.align?"text-".concat(e.align):"",style:{paddingLeft:"".concat((null!==(t=e.indent)&&void 0!==t?t:0)*2,"rem"),transition:"padding-left 0.2s ease-in-out"},children:n(e)},e.id)})})};var U=n(4657),R=n.n(U);function B(e){let t=e.tagName.toLowerCase();switch(t){case"mi":return{type:"variable",value:e.textContent||"",children:[]};case"mn":return{type:"number",value:e.textContent||"",children:[]};case"mo":return{type:"operator",value:e.textContent||"",children:[]};case"mfenced":let n=e.getAttribute("open")||"(",r=e.getAttribute("close")||")";return{type:"group",value:"fenced",children:[{type:"operator",value:n,children:[],attributes:{fence:"left",fenceType:n}},...Array.from(e.children).map(B),{type:"operator",value:r,children:[],attributes:{fence:"right",fenceType:r}}]};case"msub":let[l,a]=e.children;return{type:"subscript",value:"",children:[B(l),{...B(a),attributes:{position:"sub"}}]};case"msup":let[s,o]=e.children;return{type:"superscript",value:"",children:[B(s),{...B(o),attributes:{position:"super"}}]};case"mover":let[i,c]=e.children,d=c.textContent||"";return{type:"decoration",value:("‾"===d?"overline":"˙"===d?"dot":void 0)||"",children:[B(i)]};case"mrow":return{type:"group",value:"row",children:Array.from(e.children).map(B)};default:return console.warn("Неизвестный тег MathML: ".concat(t)),{type:"group",value:"unknown",children:Array.from(e.children).map(B)}}}function W(e){switch(e.type){case"variable":return({α:"\\alpha",β:"\\beta",θ:"\\theta",μ:"\\mu",σ:"\\sigma"})[e.value]||e.value;case"number":return e.value;case"operator":var t;if(null===(t=e.attributes)||void 0===t?void 0:t.fence)return"left"===e.attributes.fence?"\\left"+e.value:"\\right"+e.value;return e.value;case"group":return e.children.map(W).join(" ");case"subscript":return"".concat(W(e.children[0]),"_{").concat(W(e.children[1]),"}");case"superscript":return"".concat(W(e.children[0]),"^{").concat(W(e.children[1]),"}");case"decoration":let n=W(e.children[0]);switch(e.value){case"overline":return"\\overset{\\overline}{".concat(n,"}");case"dot":return"\\overset{\\cdot}{".concat(n,"}");default:return n}default:return e.children.map(W).join(" ")}}let z=()=>Math.random().toString(36).substring(2)+Date.now().toString(36),J={styleMap:["p[style-name='Section Title'] => h1:fresh","p[style-name='Subsection Title'] => h2:fresh"]};function q(e){try{return function(e){let t=new DOMParser().parseFromString(e,"text/xml").querySelector("math");return t?null!==t.querySelector("mtable")?Array.from(t.querySelectorAll("mtr")).map(e=>{let t=e.querySelector("mtd");return t?W(B(t)):""}).filter(e=>e).join(" \\\\ "):W(B(t)):(console.error("Не найден элемент math"),e)}(e)}catch(t){return console.error("Error converting MathML to LaTeX:",t),e}}async function G(e){let t=new DOMParser().parseFromString(e,"text/html"),n=[];try{let e=Array.from(t.body.children);for(let t=0;t<e.length;t++){let r=e[t],l=r.tagName.toLowerCase();if(["h1","h2","h3"].includes(l)){n.push({type:l.toUpperCase(),content:r.innerHTML,indent:0,modified:new Date().toISOString(),id:"".concat(l,"-").concat(t)});continue}if("img"===l){r.src&&n.push({type:"IMAGE",variant:"1",images:[],src:r.src,content:"",indent:0,modified:new Date().toISOString(),id:"img-".concat(t)});continue}if("p"===l){let e=function e(t){let n=[];if("img"===t.tagName.toLowerCase())return n.push(t),n;for(let r of Array.from(t.children))n.push(...e(r));return n}(r);if(e.length>0){let l=r.innerHTML;for(let r=0;r<e.length;r++){let a=e[r],s=a.outerHTML,o=l.split(s);o[0].trim()&&n.push({type:"P",content:o[0].trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-").concat(r)}),a.src&&n.push({type:"IMAGE",variant:"1",images:[],src:a.src,content:"",indent:0,modified:new Date().toISOString(),id:"img-".concat(t,"-").concat(r)}),l=o[1]||""}l.trim()&&n.push({type:"P",content:l.trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-final")})}else{let e=r.innerHTML,l=/<math[^>]*>[\s\S]*?<\/math>/g,a=e.match(l);if(a){let r=e,l=!1;for(let e of a)if(e.includes('display="block"')||e.includes('mode="display"')||e.includes('class="formula-block"')||e.includes('style="display:block"')){let a=r.split(e);for(let r of(a[0].trim()&&n.push({type:"P",content:a[0].trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-").concat(n.length)}),q(e).split("\\\\").map(e=>e.trim())))r&&n.push({type:"FORMULA",content:r,inline:!1,indent:0,modified:new Date().toISOString(),id:z()});r=a[1]||"",l=!0}else r=r.replace(e,"$".concat(q(e),"$"));r.trim()&&!l&&n.push({type:"P",content:r.trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-").concat(n.length)})}else n.push({type:"P",content:e,indent:0,modified:new Date().toISOString(),id:"p-".concat(t)})}}}return n}catch(e){throw console.error("Error parsing HTML:",e),Error("Failed to parse document content: "+(e instanceof Error?e.message:String(e)))}}async function X(e){try{let t=await R().convertToHtml({arrayBuffer:e,...J});if(!t.value)throw Error("Empty document content");return await G(t.value)}catch(e){throw console.error("Error converting DOCX:",e),Error("Failed to process document: "+(e instanceof Error?e.message:String(e)))}}n(8927);class Z{preprocessLatex(e){return e.replace(/\\left\s*{/g,"\\left\\{").replace(/\\right\s*}/g,"\\right\\}").replace(/\\left\s*\(/g,"\\left(").replace(/\\right\s*\)/g,"\\right)").replace(/\\left\s*\[/g,"\\left[").replace(/\\right\s*\]/g,"\\right]").replace(/\\overset\s*{/g,"\\overset{").replace(/\\overset\s*{\\overline}/g,"\\overline").replace(/\\overset\s*{\\cdot}/g,"\\dot").replace(/exp\s*⁡/g,"\\exp").replace(/\\alpha\s+\\overset/g,"\\alpha\\overset").replace(/\\beta\s+\\right/g,"\\beta\\right").replace(/\\sigma\s+\\alpha/g,"\\sigma\\alpha").replace(/\s+/g," ").trim()}parseFormula(e){let t=this.preprocessLatex(e);if(e.startsWith("\\begin{equation}")){var n;return{type:"equation",content:t,label:null===(n=e.match(/\\label{(.*?)}/))||void 0===n?void 0:n[1]}}return e.startsWith("$$")||e.match(/^\\\[.*\\\]$/)?{type:"block",content:t}:{type:"inline",content:t}}validateLatex(e){try{if(!e||0===e.trim().length)return!1;let t={"{":"}","[":"]","(":")"},n=[];for(let r of e)if("{[(".includes(r))n.push(r);else if("}])".includes(r)){let e=n.pop();if(!e||t[e]!==r)return!1}let r=e.includes("\\")&&!e.match(/\\[^a-zA-Z{}\[\]()]/);return 0===n.length&&r}catch(e){return!1}}}class K extends Z{parseFormula(e){let t=e.replace(/%.*$/gm,"").trim();return super.parseFormula(t)}validateLatex(e){return!!super.validateLatex(e)&&[RegExp("\\\\begin{.*?}.*?\\\\end{.*?}","s"),RegExp("\\$\\$.*?\\$\\$","s"),/\$.*?\$/g,RegExp("\\\\[.*?\\\\]","s")].some(t=>e.match(t))}}class V{findClosingBrace(e,t){let n=1,r=t;for(;n>0&&r<e.length;)"{"===e[r]&&n++,"}"===e[r]&&n--,r++;return 0===n?r-1:-1}processCommand(e,t){switch(e){case"\\Large":case"\\large":case"\\bf":case"\\mbox":return t;case"\\omega":return"ω";default:return"".concat(e,"{").concat(t,"}")}}parseCommand(e){let t=0,n="";for(;t<e.length&&/[a-zA-Z]/.test(e[t]);)n+=e[t],t++;if(t>=e.length||"{"!==e[t])return{command:"\\"+n,content:"",rest:e.slice(t)};let r=t+1,l=this.findClosingBrace(e,r);return -1===l?{command:"\\"+n,content:e.slice(r),rest:""}:{command:"\\"+n,content:e.slice(r,l),rest:e.slice(l+1)}}parseEnvironment(e,t){console.log("Парсинг окружения ".concat(t));let n="\\begin{".concat(t,"}"),r="\\end{".concat(t,"}");if(!e.startsWith(n))return console.log("Окружение ".concat(t," не найдено")),{content:"",rest:e};let l=n.length,a=e.indexOf(r);return -1===a?(console.log("Не найден конец окружения ".concat(t)),{content:"",rest:e}):(console.log("Найдено окружение ".concat(t)),{content:e.slice(l,a),rest:e.slice(a+r.length).trim()})}processEnvironment(e,t){switch(e){case"center":return t.trim();case"picture":return"";default:return"\\begin{".concat(e,"}").concat(t,"\\end{").concat(e,"}")}}parseSections(e){console.log("Начало парсинга секций"),console.log("Длина контента: ".concat(e.length," символов"));let t=[],n=e,r="",l=0,a=()=>{if(r.trim()){let e={type:"P",content:r.trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t.length)};t.push(e),r=""}};for(;n&&l<1e4;){l++;let e=!1;if(console.log("Итерация ".concat(l,", осталось символов: ").concat(n.length)),n.startsWith("\\")){let t=n.slice(1).match(/^([a-zA-Z]+)/);if(t){if("begin"===t[1]){let t=n.indexOf("{"),l=n.indexOf("}");if(-1!==t&&-1!==l){let s=n.slice(t+1,l),{content:o,rest:i}=this.parseEnvironment(n,s);if(a(),o){let e=this.processEnvironment(s,o);e&&(r+=e)}n=i,e=!0}}else{let{command:t,content:l,rest:a}=this.parseCommand(n.slice(1)),s=this.processCommand(t,l);r+=s,n=a,e=!0}}}if(!e){if(n.startsWith("$$")){a();let r=n.indexOf("$$",2);if(-1!==r){let l=n.slice(2,r),a={type:"FORMULA",content:this.mathParser.parseFormula(l).content,inline:!1,indent:0,modified:new Date().toISOString(),id:"formula-".concat(t.length)};t.push(a),n=n.slice(r+2).trim(),e=!0}}else if(n.startsWith("$")){let t=n.indexOf("$",1);if(-1!==t){let l=n.slice(1,t),a=this.mathParser.parseFormula(l);r+='<formula inline="true" source="latex">'.concat(a.content,"</formula>"),n=n.slice(t+1),e=!0}}}if(e||(r+=n[0],n=n.slice(1)),1e4===l){console.error("Достигнут лимит итераций при парсинге");break}}return a(),console.log("Парсинг завершен. Создано ".concat(t.length," блоков")),t}parseTeX(e){try{console.log("Начало парсинга TeX файла");let t=e.replace(/%.*$/gm,"").replace(/\r\n/g,"\n").replace(/\n\n+/g,"\n").trim();console.log("Комментарии удалены");let n=t.indexOf("\\begin{document}"),r=t.indexOf("\\end{document}");if(console.log("Найдены границы документа: start=".concat(n,", end=").concat(r)),-1===n||-1===r)return console.log("Документ без окружения document, парсим весь текст"),this.parseSections(t);let l=t.slice(n+16,r);return console.log("Извлечено содержимое документа"),this.parseSections(l.trim())}catch(e){return console.error("Ошибка при парсинге TeX документа:",e),[{type:"P",content:"Error parsing TeX document",indent:0,modified:new Date().toISOString(),id:"error-0"}]}}constructor(){this.mathParser=new K}}let Q=["H1","H2","H3","P","FORMULA","IMAGE","CAPTION"];function Y(e){return e.map(e=>{var t,n,r,l;switch(e.type){case"IMAGE":return{type:e.type,content:e.src||(null!==(n=null===(t=e.images)||void 0===t?void 0:t[0])&&void 0!==n?n:""),images:null!==(r=e.images)&&void 0!==r?r:[],indent:e.indent,variant:e.variant||"1"};case"FORMULA":return{type:e.type,content:e.content||"",isInline:null!==(l=e.inline)&&void 0!==l&&l,indent:e.indent};default:return{type:e.type,content:e.originalHTML||e.content||"",indent:e.indent,listType:e.listType}}})}let ee={async parseFile(e){console.log("Отправка файла на парсинг:",{name:e.name,size:e.size,type:e.type,lastModified:new Date(e.lastModified)});try{var t;switch(null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase()){case"pdf":return await et(e);case"docx":return await en(e);case"tex":return await er(e);case"json":return await el(e);default:throw Error("Неподдерживаемый формат файла")}}catch(e){throw console.error("Ошибка при парсинге файла:",e),e}}};async function et(e){let t=new FormData;t.append("file",e);let n=await fetch("".concat("https://service-pdf.teach-in.ru"),{method:"POST",body:t});if(!n.ok){let e=await n.text();throw Error("Ошибка сервиса (".concat(n.status,"): ").concat(e))}let r=await n.json();if(!r.extracted_text)throw Error("Некорректный формат ответа от сервиса");let l=function(e){let t=e.split("\n"),n=[],r=null;for(let e of t){let t=e.trim();if(!t){r&&(n.push(r),r=null);continue}t.startsWith("# ")?(r&&n.push(r),r={type:"H1",content:t.slice(2),indent:0}):t.startsWith("## ")?(r&&n.push(r),r={type:"H2",content:t.slice(3),indent:0}):t.startsWith("### ")?(r&&n.push(r),r={type:"H3",content:t.slice(4),indent:0}):t.match(/^\$\$[\s\S]*\$\$/)?(r&&n.push(r),r={type:"FORMULA",content:t.slice(2,-2).trim(),isInline:!1}):r?"P"===r.type?r.content+=" "+t:(n.push(r),r={type:"P",content:t,indent:0}):r={type:"P",content:t,indent:0}}return r&&n.push(r),n}(r.extracted_text);return{status:"success",filename:e.name,blocks:l}}async function en(e){let t=await e.arrayBuffer(),n=await X(t);return{status:"success",filename:e.name,blocks:Y(n)}}async function er(e){let t=await e.text(),n=new V().parseTeX(t);return{status:"success",filename:e.name,blocks:Y(n)}}async function el(e){let t;let n=await e.text();try{t=JSON.parse(n)}catch(e){throw Error("Некорректный формат JSON")}let r=(Array.isArray(t)?t:t.blocks||[]).map(e=>{var t,n;if("P"===e.type&&e.listType)return{type:"P",content:e.content||"",indent:"number"==typeof e.indent?e.indent:0,listType:e.listType,originalHTML:e.content};if(!e.type||!Q.includes(e.type))throw Error("Некорректный тип блока: ".concat(e.type));return"IMAGE"===e.type?{type:e.type,content:e.src||(null===(t=e.images)||void 0===t?void 0:t[0])||"",images:e.images||[],indent:"number"==typeof e.indent?e.indent:0}:"FORMULA"===e.type?{type:e.type,content:e.content||e.source||"",isInline:null!==(n=e.inline)&&void 0!==n&&n,indent:"number"==typeof e.indent?e.indent:0}:{type:e.type,content:("H1"===e.type||"H2"===e.type||"H3"===e.type||"P"===e.type||"CAPTION"===e.type)&&"originalHTML"in e?e.originalHTML:e.content,isInline:"FORMULA"===e.type?"inline"in e&&e.inline:void 0,listType:"P"===e.type?e.listType:void 0,indent:e.indent||0}}).map(P).map(e=>{var t;if("IMAGE"===e.type&&"src"in e)return{type:e.type,content:e.src||"",images:e.images||[],indent:e.indent||0};if("content"in e)return{type:e.type,content:("H1"===e.type||"H2"===e.type||"H3"===e.type||"P"===e.type||"CAPTION"===e.type)&&e.originalHTML||e.content,isInline:"FORMULA"===e.type?"inline"in e&&e.inline:void 0,listType:"P"===e.type?e.listType:void 0,indent:e.indent||0};throw Error("Некорректный формат блока после очистки: ".concat(null!==(t=e.type)&&void 0!==t?t:"unknown"))});return{status:"success",filename:e.name,blocks:r}}var ea=n(3835);let es={"application/pdf":[".pdf"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".tex"],"application/json":[".json"]},eo=e=>{let{onImport:t}=e,[n,a]=(0,l.useState)(!1),[s,o]=(0,l.useState)(null),[i,c]=(0,l.useState)(0),d=async e=>{0!==e.length&&await m(e[0])},{getRootProps:u,getInputProps:p,isDragActive:g}=(0,ea.uI)({onDrop:d,accept:es,maxFiles:1,multiple:!1}),m=async e=>{a(!0),o(null),c(0);try{let n=setInterval(()=>{c(e=>Math.min(e+10,90))},500),r=await ee.parseFile(e);if(clearInterval(n),c(100),0===r.blocks.length)throw Error("Не удалось извлечь содержимое из документа");t(r.blocks),setTimeout(()=>{c(0),a(!1)},1e3)}catch(e){console.error("Ошибка при обработке файла:",e),o(e instanceof Error?e.message:"Ошибка при импорте файла"),a(!1),c(0)}};return(0,r.jsxs)("div",{...u(),className:"dropzone ".concat(g?"active":""," ").concat(s?"error":""),children:[(0,r.jsx)("input",{...p()}),n?(0,r.jsxs)("div",{className:"loading-state",children:[(0,r.jsx)("div",{className:"progress-bar",children:(0,r.jsx)("div",{className:"progress-fill",style:{width:"".concat(i,"%")}})}),(0,r.jsxs)("p",{children:["Обработка документа... ",i,"%"]})]}):s?(0,r.jsxs)("div",{className:"error-state",children:[(0,r.jsx)(S.vVM,{className:"icon error"}),(0,r.jsx)("p",{children:s})]}):g?(0,r.jsxs)("div",{className:"drag-active",children:[(0,r.jsx)(S.Ap8,{className:"icon"}),(0,r.jsx)("p",{children:"Отпустите файл здесь..."})]}):(0,r.jsxs)("div",{className:"idle-state",children:[(0,r.jsx)(S.Ap8,{className:"icon"}),(0,r.jsx)("p",{children:"Перетащите файл сюда или кликните для выбора"}),(0,r.jsxs)("p",{className:"supported-formats",children:["Поддерживаемые форматы: ",Object.values(es).flat().join(", ").replace(/\./g,"").toUpperCase()]})]})]})};var ei=n(795),ec=n(3662),ed=n(9892),eu=n(7244);let ep='Ты LaTeX эксперт. Задача: найти математические формулы в тексте и преобразовать их в LaTeX. Ответ должен быть строго в формате JSON.\n\nВАЖНО: Отвечай максимально быстро. Не думай слишком долго.\n\nПравила форматирования:\n1. Математические символы и переменные оборачивать в $: K → $K$\n2. Операторы писать как \\text{}: char → $\\text{char}$\n3. Индексы через _: x1 → $x_1$\n4. Степени через ^: An → $A^n$\n5. Множества в \\{\\}: {x} → $\\{x\\}$\n6. Стрелки и символы: ↔ → $\\leftrightarrow$, ∈ → $\\in$\n7. Производные записывать БЕЗ фигурных скобок:\n   - x\' вместо x^{\'}\n   - x\'\' вместо x^{\' \'}\n   - x\'\'\' вместо x^{\' \' \'}\n8. Экспоненту писать как e^{...}, а не ⅇ:\n   - e^{2t} вместо ⅇ^{2t}\n   - e^t вместо ⅇ^t\n\nПримеры:\n"x\' + y\'" → "$x\' + y\'$"\n"x\'\' - 2x\'" → "$x\'\' - 2x\'$"\n"x\'\'\' + 3x\'\'" → "$x\'\'\' + 3x\'\'$"\n"ee^{2t}" → "$e^{2t}$"\n\nФормат ответа строго JSON:\n{\n  "original": "текст",\n  "corrected": "текст с $формулами$",\n  "changes": [{"position": число, "before": "было", "after": "стало"}]\n}',eg=async e=>{let t=new AbortController,n=setTimeout(()=>t.abort(),45e3);try{var r,l,a;let s=e.content,o=s.replace(/ⅇ/g,"e").replace(/\{'\s*'\s*'\}/g,"'''").replace(/\{'\s*'\}/g,"''").replace(/\{'\}/g,"'"),i={model:"deepseek-chat",messages:[{role:"system",content:ep},{role:"user",content:JSON.stringify({task:"Найди формулы и преобразуй в LaTeX",content:o})}],temperature:.1,max_tokens:2e3,response_format:{type:"json_object"}};console.log("DeepSeek request:",JSON.stringify({url:"/api/deepseek/chat/completions",body:i},null,4));let c=await fetch("/api/deepseek/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},signal:t.signal,body:JSON.stringify(i)});if(clearTimeout(n),!c.ok){let e=await c.text();throw console.error("DeepSeek API error:",{status:c.status,statusText:c.statusText,error:e}),Error("API error: ".concat(c.status," - ").concat(e))}let d=await c.json();if(console.log("DeepSeek API response:",d),!(null===(a=d.choices)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:null===(r=l.message)||void 0===r?void 0:r.content))throw console.error("Empty response from API:",d),Error("Empty response from API");let u=JSON.parse(d.choices[0].message.content);if(console.log("Parsed DeepSeek result:",u),!u.original||!u.corrected||!Array.isArray(u.changes))return{original:s,corrected:s,changes:[]};return"FORMULA"!==e.type||e.inline||(console.log("Post-processing block formula, removing $ wrapper"),u.corrected=u.corrected.replace(/^\$|\$$/g,""),u.changes=u.changes.map(e=>({...e,after:e.after.replace(/^\$|\$$/g,"")})),console.log("Post-processed result:",u)),u.changes=u.changes.filter(e=>"number"==typeof e.position&&"string"==typeof e.before&&"string"==typeof e.after),u.corrected=u.corrected.replace(/\{'\s*'\s*'\}/g,"'''").replace(/\{'\s*'\}/g,"''").replace(/\{'\}/g,"'").replace(/ⅇ/g,"e"),u}catch(t){return clearTimeout(n),{original:e.content,corrected:e.content,changes:[]}}},em=async e=>{let t=new AbortController,n=setTimeout(()=>t.abort(),45e3);try{var r,l,a;let s=e.replace(/ⅇ/g,"e").replace(/\{'\s*'\s*'\}/g,"'''").replace(/\{'\s*'\}/g,"''").replace(/\{'\}/g,"'"),o={model:"deepseek-chat",messages:[{role:"system",content:ep},{role:"user",content:JSON.stringify({task:"Найди формулы и преобразуй в LaTeX",content:s})}],temperature:.1,max_tokens:2e3,response_format:{type:"json_object"}};console.log("DeepSeek inline request:",JSON.stringify({url:"/api/deepseek/chat/completions",body:o},null,4));let i=await fetch("/api/deepseek/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},signal:t.signal,body:JSON.stringify(o)});if(clearTimeout(n),!i.ok){let e=await i.text();throw console.error("DeepSeek API error:",{status:i.status,statusText:i.statusText,error:e}),Error("API error: ".concat(i.status," - ").concat(e))}let c=await i.json();if(console.log("DeepSeek API response:",c),!(null===(a=c.choices)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:null===(r=l.message)||void 0===r?void 0:r.content))throw console.error("Empty response from API:",c),Error("Empty response from API");let d=JSON.parse(c.choices[0].message.content);if(console.log("Parsed DeepSeek result:",d),!d.original||!d.corrected||!Array.isArray(d.changes))return{original:e,corrected:e,changes:[]};return d.changes=d.changes.filter(e=>"number"==typeof e.position&&"string"==typeof e.before&&"string"==typeof e.after),d.corrected=d.corrected.replace(/\{'\s*'\s*'\}/g,"'''").replace(/\{'\s*'\}/g,"''").replace(/\{'\}/g,"'").replace(/ⅇ/g,"e"),d}catch(t){return clearTimeout(n),{original:e,corrected:e,changes:[]}}},eh=e=>{let{block:t,onUpdate:n,onDelete:a,onAdd:s,blockControls:o,children:i}=e,[c,d]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!1),g=(0,l.useRef)(null),{checkFormula:m,isChecking:h}=function(){let e=(0,eu.D)({mutationFn:async e=>{let t=await eg(e);return{block:e,result:t}},onSuccess:e=>{let{block:t,result:n}=e;if(n.changes.length>0&&t.onUpdate){let e={content:n.corrected,changes:n.changes};t.onUpdate(e)}}});return{checkFormula:e.mutate,isChecking:e.isPending,error:e.error}}();(0,l.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let x=[{type:"H1",icon:S.SQS,label:"Заголовок"},{type:"P",icon:S.BAW,label:"Параграф"},{type:"FORMULA",icon:S.l0y,label:"Формула"},{type:"IMAGE",icon:S.e0s,label:"Изображение"}];return(0,r.jsxs)("div",{className:"group/block relative",children:[(0,r.jsx)("div",{className:"relative",children:i}),(0,r.jsx)("div",{className:"absolute right-0 top-0 opacity-0 group-hover/block:opacity-100 transition-opacity duration-200",children:(0,r.jsxs)("div",{className:"relative",ref:g,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:()=>{t.content&&m({...t,onUpdate:n})},disabled:h,className:"p-1.5 rounded-md hover:bg-blue-50 text-blue-500 \n                transition-colors ".concat(h?"opacity-50 cursor-not-allowed":""),title:"Проверить формулы","aria-label":"Проверить формулы в блоке",children:[(0,r.jsx)(S.tSv,{className:"w-4 h-4"}),h&&(0,r.jsxs)("span",{className:"absolute -top-1 -right-1 w-2 h-2",children:[(0,r.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"}),(0,r.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-blue-500"})]})]}),(0,r.jsx)("button",{onClick:()=>d(!c),className:"p-1.5 rounded-md hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(S.rgS,{className:"w-4 h-4"})})]}),c&&(0,r.jsxs)("div",{className:"absolute right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 min-w-[180px] z-50",children:[(0,r.jsx)("div",{className:"px-3 py-1.5 text-xs font-medium text-gray-500 border-b border-gray-100",children:t.type}),(0,r.jsxs)("button",{onClick:()=>p(!u),className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-gray-50 text-gray-700 text-sm",children:[(0,r.jsx)(S.xoN,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:u?"Скрыть JSON":"Показать JSON"})]}),(0,r.jsxs)("button",{onClick:()=>{a(),d(!1)},className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-red-50 text-red-600 text-sm",children:[(0,r.jsx)(S.ZkW,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Удалить блок"})]}),(0,r.jsxs)("div",{className:"border-t border-gray-100 mt-1 pt-1",children:[(0,r.jsx)("div",{className:"px-3 py-1.5 text-xs font-medium text-gray-500",children:"Добавить блок"}),x.map(e=>(0,r.jsxs)("button",{onClick:()=>{s(e.type),d(!1)},className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-gray-50 text-gray-700 text-sm",children:[(0,r.jsx)(e.icon,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:e.label})]},e.type))]})]})]})}),u&&(0,r.jsx)("div",{className:"mt-2 px-3 py-2 bg-gray-50 rounded-md border border-gray-200 font-mono text-xs text-gray-600 overflow-x-auto",children:(0,r.jsx)("pre",{children:JSON.stringify(t,null,2)})}),o&&(0,r.jsx)("div",{className:"absolute right-8 top-0 opacity-0 group-hover/block:opacity-100 transition-opacity duration-200",children:o})]})},ex=e=>{let{block:t,isSelected:n,onSelect:a,onUpdate:s,onDelete:o,onAdd:i,activeFormats:c,onActiveFormatsChange:d,onEnterPress:u}=e,[p,g]=(0,l.useState)(!1),{attributes:m,listeners:h,setNodeRef:x,transform:f,transition:y,isDragging:v}=(0,ec.nB)({id:t.id}),w={transform:ed.ux.Transform.toString(f),transition:y,opacity:v?.5:1};return(0,r.jsxs)("div",{ref:x,style:w,className:"relative group ".concat((()=>{switch(t.type){case"H1":return"mb-6";case"H2":return"mb-4 mt-6";case"H3":return"mb-3 mt-4";case"P":return"mb-3";case"CAPTION":return"mb-4";case"IMAGE":case"FORMULA":return"my-6";default:return""}})()," transition-all duration-200"),onClick:a,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none transition-opacity duration-200 \n          ".concat(n||p?"opacity-100":"opacity-0","\n          ").concat(n?"bg-blue-50/30 ring-1 ring-blue-200":"bg-gray-50/30")}),(0,r.jsx)("div",{...m,...h,className:"absolute left-0 top-1/2 -translate-x-[calc(100%+4px)] -translate-y-1/2 \n          transition-opacity duration-200 ".concat(n||p?"opacity-100":"opacity-0"),children:(0,r.jsx)("div",{className:"p-1.5 cursor-move hover:bg-blue-100 rounded-md transition-colors",children:(0,r.jsx)(S.iVq,{className:"w-4 h-4 text-blue-400"})})}),(0,r.jsx)("div",{className:"relative ".concat(n?"z-10":""),children:(0,r.jsx)(eh,{block:t,onUpdate:s,onDelete:o,onAdd:i,children:(()=>{switch(t.type){case"H1":case"H2":case"H3":case"P":case"CAPTION":return(0,r.jsx)(b,{block:t,onUpdate:s,onDelete:o,onAdd:i,activeFormats:n?c:void 0,onActiveFormatsChange:d,onEnterPress:u,shouldFocus:t.$new});case"FORMULA":return(0,r.jsx)(j,{block:t,onUpdate:s});case"IMAGE":return(0,r.jsx)(k,{block:t,onUpdate:s});default:return null}})()})})]})};var ef=n(1140),ey=n(4154),eb=n(5168);let ev=e=>{let{onBlockTypeChange:t,onTextAlignChange:n,onTextCaseChange:a,onFormatClick:s,onClearFormat:o,onListClick:i,onFormulaClick:c,onDeepSeekConvert:d,onIndentChange:u,canIndentLeft:p,canIndentRight:g,canUndo:m,canRedo:h,onUndo:x,onRedo:f,activeFormats:y}=e,[b,v]=(0,l.useState)(!1),w=[{icon:ef.Cxy,label:"Заголовок",type:"H1"},{icon:ef.hH4,label:"Подзаголовок",type:"H2"},{icon:ef.CGP,label:"Малый заголовок",type:"H3"},{icon:ef.OWN,label:"Параграф",type:"P"},{icon:ey.Z24,label:"Подпись",type:"CAPTION"}],j=ef.OWN;return(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-white border border-gray-200 rounded-lg p-1.5 shadow-sm",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>v(!b),className:"flex items-center gap-1 px-2 py-1.5 rounded hover:bg-gray-100 text-gray-700",children:[(0,r.jsx)(j,{className:"w-4 h-4"}),(0,r.jsx)(S.Ix0,{className:"w-4 h-4"})]}),b&&(0,r.jsx)("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 min-w-[160px] z-50",children:w.map(e=>(0,r.jsxs)("button",{onClick:()=>{t(e.type),v(!1)},className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-gray-50 text-gray-700 text-sm",children:[(0,r.jsx)(e.icon,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:e.label})]},e.type))})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>s("bold"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 ".concat((null==y?void 0:y.bold)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Жирный (Ctrl+B)",children:(0,r.jsx)(S.fO_,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>s("italic"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 ".concat((null==y?void 0:y.italic)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Курсив (Ctrl+I)",children:(0,r.jsx)(S.W0y,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>s("underline"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 ".concat((null==y?void 0:y.underline)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Подчеркнутый (Ctrl+U)",children:(0,r.jsx)(S.$kk,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>s("superscript"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 ".concat((null==y?void 0:y.superscript)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Верхний индекс",children:(0,r.jsx)(S._Jf,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:o,className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Очистить форматирование (Ctrl+\\)",children:(0,r.jsx)(S.w7s,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>n("left"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"По левому краю",children:(0,r.jsx)(S.eq2,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>n("center"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"По центру",children:(0,r.jsx)(S.wWG,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>n("right"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"По правому краю",children:(0,r.jsx)(S.rmK,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>i("bullet"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Маркированный список",children:(0,r.jsx)(S.f_H,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>i("number"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Нумерованный список",children:(0,r.jsx)(S.C4F,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:c,className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Вставить формулу",children:(0,r.jsx)(S.l0y,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:d,className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Конвертировать через DeepSeek",children:(0,r.jsx)(S.kk0,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:x,disabled:!m,className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Отменить (Ctrl+Z)",children:(0,r.jsx)(S.TsG,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:f,disabled:!h,className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Повторить (Ctrl+Shift+Z)",children:(0,r.jsx)(S.VUZ,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>a("uppercase"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"ВЕРХНИЙ РЕГИСТР",children:(0,r.jsx)(eb.ZfG,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>a("lowercase"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"нижний регистр",children:(0,r.jsx)(eb.eSD,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>a("capitalize"),className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Каждое Слово С Заглавной",children:(0,r.jsx)(eb.sDt,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>u("left"),disabled:!p,className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Уменьшить отступ",children:(0,r.jsx)(S.IXt,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>u("right"),disabled:!g,className:"toolbar-button p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Увеличить отступ",children:(0,r.jsx)(S.CYn,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"w-px h-5 bg-gray-200"})]})},ew=e=>{let{blockId:t,...n}=e,[a,s]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(t)s(!0);else{let e=setTimeout(()=>s(!1),200);return()=>clearTimeout(e)}},[t]),(0,r.jsx)("div",{className:"\n        sticky top-0 z-50 transition-all duration-200 ease-in-out\n        ".concat(a?"opacity-100 translate-y-0":"opacity-0 -translate-y-4","\n      "),children:(0,r.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-screen-xl mx-auto px-4",children:(0,r.jsx)(ev,{...n})})})})},ej=e=>{var t,n;let{initialData:s,onChange:o}=e,[i,c]=(0,l.useState)((null==s?void 0:s.blocks)||[]),[d,u]=(0,l.useState)(null),[p,g]=(0,l.useState)(null),[m,h]=(0,l.useState)({past:[],present:[],future:[]}),[x,f]=(0,l.useState)({bold:!1,italic:!1,underline:!1,superscript:!1}),[y,b]=(0,l.useState)(!1),[v,w]=(0,l.useState)(null),[j,N]=(0,l.useState)(!1),k=(0,ei.Dy)((0,ei.VT)(ei.we),(0,ei.VT)(ei.Lg,{coordinateGetter:ec.is})),C=(0,l.useCallback)(e=>{h(t=>({past:[...t.past,t.present],present:e,future:[]})),c(e),null==o||o({id:(null==s?void 0:s.id)||"draft",title:(null==s?void 0:s.title)||"Untitled",blocks:e,createdAt:(null==s?void 0:s.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString()})},[i,o,s]),E=e=>{let t={id:(0,a.x0)(10),indent:0,type:e,modified:new Date().toISOString(),$new:!0};return"H1"===e||"H2"===e||"H3"===e||"P"===e||"CAPTION"===e?{...t,type:e,content:""}:"FORMULA"===e?{...t,type:e,source:"latex",content:""}:"IMAGE"===e?{...t,type:e,variant:"1",images:[],src:"",content:""}:{...t,type:e,content:""}},A=(e,t)=>{let n;let r=E(e);if(t){let e=i.findIndex(e=>e.id===t);n=[...i.slice(0,e+1),r,...i.slice(e+1)]}else n=[...i,r];C(n),u(r.id),g(r.id)},T=(0,l.useCallback)((e,t)=>{console.log("Block update:",{blockId:e,updates:t}),c(n=>n.map(n=>{if(n.id===e){let e="changes"in n&&n.changes||[],r="changes"in t&&t.changes||[],l={...n,...t,changes:[...e,...r]};return console.log("Updated block:",l),l}return n}))},[]),O=(0,l.useCallback)(e=>t=>{T(e,t)},[T]),L=e=>{C(i.filter(t=>t.id!==e))},I=e=>{f(e)},M=async()=>{console.log("DeepSeek button clicked");let e=i.find(e=>e.id===d);if(console.log("Selected block:",e),!e||!("content"in e)){console.log("No valid block found");return}let t=document.querySelector('[data-block-id="'.concat(d,'"]'));console.log("Editor container:",t);let n=null==t?void 0:t.__tiptapEditor;if(console.log("Editor instance:",n),console.log("Available commands:",null==n?void 0:n.commands),n&&!j){let{from:t,to:r}=n.state.selection,l=n.state.doc.textBetween(t,r);if(console.log("Selected text for DeepSeek:",l),!l){console.log("No text selected");return}N(!0);try{console.log("Sending to DeepSeek:",l);let t=await em(l);console.log("DeepSeek result:",t),t.corrected?(console.log("Inserting corrected content:",t.corrected),n.chain().focus().insertContent(t.corrected).run(),console.log("Updating block with changes:",t.changes),T(e.id,{changes:t.changes})):console.log("No corrected content in result")}catch(e){console.error("DeepSeek error:",e)}finally{N(!1)}}else console.log("Editor not ready or already converting:",{editorExists:!!n,isConverting:j})};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(ew,{blockId:d,onBlockTypeChange:e=>{d&&T(d,{type:e})},onTextAlignChange:e=>{d&&T(d,{align:e})},onTextCaseChange:e=>{if(!d)return;let t=i.find(e=>e.id===d);t&&"content"in t&&T(d,{textCase:e})},onFormatClick:e=>{let t=i.find(e=>e.id===d);t&&"content"in t&&f(t=>({...t,[e]:!t[e]}))},onClearFormat:()=>{let e=i.find(e=>e.id===d);e&&"content"in e&&(f({bold:!1,italic:!1,underline:!1,superscript:!1}),T(e.id,{align:"left",textCase:"none"}))},onListClick:e=>{let t=i.find(e=>e.id===d);if(t&&"content"in t&&("H1"===t.type||"H2"===t.type||"H3"===t.type||"P"===t.type||"CAPTION"===t.type)){let n={bullet:"unordered",number:"ordered"}[e];t.listType===n?T(t.id,{listType:void 0}):T(t.id,{listType:n})}},onFormulaClick:()=>{console.log("Formula button clicked");let e=i.find(e=>e.id===d);if(console.log("Selected block:",e),!e||!("content"in e)){console.log("No valid block found");return}let t=document.querySelector('[data-block-id="'.concat(d,'"]'));console.log("Editor container:",t);let n=null==t?void 0:t.__tiptapEditor;if(console.log("Editor instance:",n),n){let{from:e,to:t}=n.state.selection,r=n.state.doc.textBetween(e,t);if(console.log("Selected text for formula:",r),!r){console.log("No text selected");return}if(r.startsWith("$")&&r.endsWith("$")){console.log("Text is already a formula");return}let l="$".concat(r,"$");console.log("Converting to formula:",l),n.chain().focus().insertContent(l).run(),console.log("Formula inserted")}},onDeepSeekConvert:M,onIndentChange:e=>{let t=i.find(e=>e.id===d);if(!t)return;let n=t.indent||0,r=n;"right"===e&&n<4?r=n+1:"left"===e&&n>0&&(r=n-1),r!==n&&T(t.id,{indent:r})},canIndentLeft:!!d&&((null===(t=i.find(e=>e.id===d))||void 0===t?void 0:t.indent)||0)>0,canIndentRight:!!d&&4>((null===(n=i.find(e=>e.id===d))||void 0===n?void 0:n.indent)||0),canUndo:m.past.length>0,canRedo:m.future.length>0,onUndo:()=>{if(0===m.past.length)return;let e=m.past[m.past.length-1];h({past:m.past.slice(0,m.past.length-1),present:e,future:[m.present,...m.future]}),c(e)},onRedo:()=>{if(0===m.future.length)return;let e=m.future[0],t=m.future.slice(1);h({past:[...m.past,m.present],present:e,future:t}),c(e)},activeFormats:x}),(0,r.jsxs)("div",{className:"max-w-screen-xl mx-auto",children:[(0,r.jsx)("div",{className:"flex justify-between items-center mb-4 px-4",children:(0,r.jsx)(eo,{onImport:e=>{C([...i,...e.map(e=>({...e,id:(0,a.x0)(10),modified:new Date().toISOString()}))])}})}),(0,r.jsx)("div",{className:"p-4",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm",children:0===i.length?(0,r.jsx)("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"text-gray-500",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Начните создавать статью"}),(0,r.jsx)("p",{className:"text-sm mb-4",children:"Выберите тип блока, чтобы начать"}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>A("H1"),className:"flex items-center gap-2 px-4 py-2 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all group",children:[(0,r.jsx)("span",{className:"text-lg font-bold text-gray-400 group-hover:text-blue-500",children:"H1"}),(0,r.jsx)("span",{className:"text-gray-500 group-hover:text-blue-600",children:"Заголовок"})]}),(0,r.jsx)("span",{className:"text-2xl font-bold text-gray-400",children:"∨"}),(0,r.jsxs)("button",{onClick:()=>A("P"),className:"flex items-center gap-2 px-4 py-2 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all group",children:[(0,r.jsx)("span",{className:"text-lg font-bold text-gray-400 group-hover:text-blue-500",children:"\xb6"}),(0,r.jsx)("span",{className:"text-gray-500 group-hover:text-blue-600",children:"Параграф"})]})]})]}),(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Используйте панель инструментов для форматирования"})]})}):(0,r.jsx)(ei.LB,{sensors:k,collisionDetection:ei.pE,onDragEnd:e=>{let{active:t,over:n}=e;n&&t.id!==n.id&&c(e=>{let r=e.findIndex(e=>e.id===t.id),l=e.findIndex(e=>e.id===n.id),a=(0,ec.Rp)(e,r,l);return null==o||o({id:(null==s?void 0:s.id)||"draft",title:(null==s?void 0:s.title)||"Untitled",blocks:a,createdAt:(null==s?void 0:s.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString()}),a})},children:(0,r.jsx)(ec.Fo,{items:i.map(e=>e.id),strategy:ec.qw,children:i.map(e=>(0,r.jsx)(ex,{block:e,isSelected:d===e.id,onSelect:()=>u(e.id),onUpdate:O(e.id),onDelete:()=>L(e.id),onAdd:t=>A(t,e.id),activeFormats:d===e.id?x:void 0,onActiveFormatsChange:I,onEnterPress:()=>A("P",e.id)},e.id))})})})})]}),(0,r.jsxs)("div",{className:"fixed bottom-4 right-4 z-50 flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>b(!0),className:"bg-green-500 hover:bg-green-600 text-white p-3 rounded-full shadow-lg transition-all hover:scale-105",title:"Предпросмотр статьи",children:(0,r.jsx)(S.Sbz,{className:"w-6 h-6"})}),(0,r.jsx)(D,{blocks:i})]}),y&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center p-4 z-50 overflow-auto",children:(0,r.jsxs)("div",{className:"bg-gray-100 rounded-lg shadow-xl w-full min-h-screen relative",children:[(0,r.jsx)("button",{onClick:()=>b(!1),className:"absolute top-4 right-4 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors",title:"Закрыть предпросмотр",children:(0,r.jsx)(S.FU5,{className:"w-6 h-6"})}),(0,r.jsx)(_,{blocks:i})]})})]})}}},function(e){e.O(0,[329,950,522,51,779,572,902,540,639,262,134,971,117,744],function(){return e(e.s=4971)}),_N_E=e.O()}]);