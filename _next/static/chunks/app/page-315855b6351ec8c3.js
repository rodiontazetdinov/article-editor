(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4971:function(e,t,r){Promise.resolve().then(r.bind(r,2721))},2721:function(e,t,r){"use strict";r.d(t,{ArticleEditor:function(){return G}});var a=r(7437),l=r(2265),n=r(3619),s=r(5015),i=r(9512),o=r(3971),c=r(5318),d=r(8234),u=r(4725),p=r(808),m=r(144),g=r(4887);r(2446);let x=e=>e.replace(/\\left\s*{/g,"\\left\\{").replace(/\\right\s*}/g,"\\right\\}").replace(/\\left\s*\(/g,"\\left(").replace(/\\right\s*\)/g,"\\right)").replace(/\\left\s*\[/g,"\\left[").replace(/\\right\s*\]/g,"\\right]").replace(/\\overset\s*{/g,"\\overset{").replace(/\\overset\s*{\\overline}/g,"\\overline").replace(/\\overset\s*{\\cdot}/g,"\\dot").replace(/exp\s*⁡/g,"\\exp").replace(/\\alpha\s+\\overset/g,"\\alpha\\overset").replace(/\\beta\s+\\right/g,"\\beta\\right").replace(/\\sigma\s+\\alpha/g,"\\sigma\\alpha").replace(/\s+/g," ").trim(),h=u.NB.create({name:"formula",group:"inline",inline:!0,atom:!0,addAttributes:()=>({content:{default:""}}),parseHTML:()=>[{tag:'span[data-type="formula"]',getAttrs:e=>"string"==typeof e?{}:{content:e.getAttribute("data-formula")}}],renderHTML(e){let{HTMLAttributes:t}=e;return["span",{"data-type":"formula","data-formula":t.content,class:"inline-formula"}]},addNodeView:()=>e=>{let{node:t,editor:r}=e,a=document.createElement("span");a.style.display="inline-block",a.style.verticalAlign="middle",a.style.padding="0 4px",a.style.margin="0 1px",a.style.backgroundColor="rgba(232, 244, 253, 0.8)",a.style.borderRadius="4px",a.style.border="1px solid rgba(187, 222, 251, 0.5)",a.style.transition="all 0.2s ease-in-out",a.style.cursor="pointer",a.style.minWidth="20px",a.style.minHeight="24px",a.className="inline-formula";let n=document.createElement("div");n.style.position="fixed",n.style.zIndex="1000",n.style.top="0",n.style.left="0",document.body.appendChild(n);let s=!1,i=e=>{try{let t=e.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/\\\\/g,"\\"),r=x(t),n=a.offsetWidth,s=a.offsetHeight;for(;a.firstChild;)a.removeChild(a.firstChild);let i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.minWidth="".concat(Math.max(n,20),"px"),i.style.minHeight="".concat(Math.max(s,24),"px"),a.appendChild(i),g.render(l.createElement(m.InlineMath,{math:r,errorColor:"#e53e3e",renderError:e=>(console.error("KaTeX error:",e),l.createElement("span",{style:{color:"#e53e3e",cursor:"help",borderBottom:"1px dotted #e53e3e"},title:e.message},"$".concat(t,"$")))}),i)}catch(t){console.error("Error rendering formula:",t),a.innerHTML='<span style="color: #e53e3e; cursor: help; border-bottom: 1px dotted #e53e3e" title="'.concat(t instanceof Error?t.message:"Unknown error",'">').concat(e,"</span>"),a.style.backgroundColor="rgba(254, 242, 242, 0.8)",a.style.border="1px solid rgba(252, 165, 165, 0.5)"}},o=e=>{let{content:t,onSave:r,onCancel:a}=e,[n,s]=l.useState(t),i=l.useRef(null);return l.useEffect(()=>{i.current&&i.current.focus()},[]),l.createElement("div",{style:{position:"absolute",backgroundColor:"white",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",borderRadius:"6px",padding:"8px",width:"300px"}},[l.createElement("textarea",{key:"textarea",ref:i,value:n,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.shiftKey?(e.preventDefault(),r(n)):"Escape"===e.key&&(e.preventDefault(),a())},style:{width:"100%",minHeight:"60px",padding:"8px",border:"1px solid #e2e8f0",borderRadius:"4px",backgroundColor:"#f8fafc",fontFamily:"monospace",fontSize:"14px",resize:"vertical",marginBottom:"8px"}}),l.createElement("div",{key:"preview",style:{padding:"8px",backgroundColor:"#f8fafc",borderRadius:"4px",marginBottom:"8px",minHeight:"30px"}},l.createElement(m.InlineMath,{math:x(n)})),l.createElement("div",{key:"buttons",style:{display:"flex",gap:"8px"}},[l.createElement("button",{key:"save",onClick:()=>r(n),style:{backgroundColor:"#4299e1",color:"white",padding:"4px 12px",borderRadius:"4px",fontSize:"14px",cursor:"pointer",border:"none"}},"Сохранить"),l.createElement("button",{key:"cancel",onClick:a,style:{backgroundColor:"#e2e8f0",color:"#4a5568",padding:"4px 12px",borderRadius:"4px",fontSize:"14px",cursor:"pointer",border:"none"}},"Отмена")])])},c=()=>{s&&(s=!1,g.unmountComponentAtNode(n))};return a.addEventListener("click",()=>{if(s)return;s=!0;let e=a.getBoundingClientRect();n.style.left="".concat(e.left,"px"),n.style.top="".concat(e.bottom+4,"px");let d=e=>{c(),r.commands.updateAttributes(t.type.name,{content:e}),requestAnimationFrame(()=>{i(e)})};document.addEventListener("mousedown",e=>{let t=e.target;if(t instanceof Element&&!n.contains(t)&&!a.contains(t)){let e=n.querySelector("textarea");e?d(e.value):c()}}),g.render(l.createElement(o,{content:t.attrs.content||"",onSave:d,onCancel:()=>{c()}}),n)}),a.addEventListener("mouseenter",()=>{s||(a.style.backgroundColor="rgba(187, 222, 251, 0.3)",a.style.border="1px solid rgba(187, 222, 251, 0.8)")}),a.addEventListener("mouseleave",()=>{s||(a.style.backgroundColor="rgba(232, 244, 253, 0.8)",a.style.border="1px solid rgba(187, 222, 251, 0.5)")}),i(t.attrs.content||""),{dom:a,update:e=>e.type===t.type&&(t=e,s||setTimeout(()=>{i(e.attrs.content||"")},0),!0),destroy:()=>{g.unmountComponentAtNode(a),n.parentNode&&n.parentNode.removeChild(n)}}},addCommands(){return{setFormula:e=>t=>{let{chain:r}=t;return r().focus().insertContent([{type:this.name,attrs:{content:e}}]).run()}}}}),f=e=>{let{block:t,onUpdate:r,activeFormats:n,onActiveFormatsChange:u,onEnterPress:m,onDelete:g,onAdd:f,shouldFocus:b}=e,y=(0,l.useRef)(null),v=(0,s.jE)({extensions:[i.Z.configure({bold:!1,heading:{levels:[1,2,3]},bulletList:{HTMLAttributes:{class:"list-disc ml-4 space-y-1"}},orderedList:{HTMLAttributes:{class:"list-decimal ml-4 space-y-1"}},paragraph:{HTMLAttributes:{class:"leading-relaxed"}}}),p.ZP.configure({HTMLAttributes:{class:"font-bold"}}),o.Z,d.Z,c.Z.configure({types:["heading","paragraph"]}),h],content:t.content.replace(/\$(.*?)\$/g,(e,t)=>{let r=x(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"\\\\");return'<span data-type="formula" data-formula="'.concat(r,'"></span>')}),onUpdate:e=>{let{editor:t}=e;r({content:t.getHTML().replace(/<span data-type="formula" data-formula="(.*?)"><\/span>/g,(e,t)=>{let r=x(t.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/\\\\/g,"\\"));return"$".concat(r,"$")})})},onSelectionUpdate:e=>{let{editor:t}=e;u&&u({bold:t.isActive("bold"),italic:t.isActive("italic"),underline:t.isActive("underline"),superscript:t.isActive("superscript")})},editorProps:{attributes:{class:(e=>{switch(e){case"H1":return"text-4xl font-bold tracking-tight";case"H2":return"text-3xl font-bold tracking-tight";case"H3":return"text-2xl font-bold tracking-tight";case"P":return"text-lg leading-relaxed";case"CAPTION":return"text-sm text-gray-600 italic";default:return""}})(t.type)},handleKeyDown:(e,t)=>{if("Enter"===t.key&&!t.shiftKey){let{$from:r}=e.state.selection;if(!(j(e.state,"bulletList")||j(e.state,"orderedList")))return t.preventDefault(),null==m||m(),!0;if(""===r.parent.textContent.trim())return t.preventDefault(),null==v||v.chain().focus().liftListItem("listItem").run(),null==m||m(),!0}return!1}}});(0,l.useEffect)(()=>{v&&(y.current=v)},[v]),(0,l.useCallback)(()=>{if(!v)return;let{from:e,to:t}=v.state.selection,r=v.state.doc.textBetween(e,t);r&&v.chain().focus().setFormula(r).run()},[v]);let j=(e,t)=>{let{$from:r}=e.selection,a=r.depth;for(;a>0;){if(r.node(a).type.name===t)return!0;a--}return!1};return((0,l.useEffect)(()=>{v&&n&&(n.bold!==v.isActive("bold")&&v.chain().focus().toggleBold().run(),n.italic!==v.isActive("italic")&&v.chain().focus().toggleItalic().run(),n.underline!==v.isActive("underline")&&v.chain().focus().toggleUnderline().run(),n.superscript!==v.isActive("superscript")&&v.chain().focus().toggleSuperscript().run())},[v,n]),(0,l.useEffect)(()=>{v&&t.listType&&("bullet"===t.listType?v.chain().focus().toggleBulletList().run():"number"===t.listType&&v.chain().focus().toggleOrderedList().run())},[v,t.listType]),(0,l.useEffect)(()=>{v&&t.align&&v.chain().focus().setTextAlign(t.align).run()},[v,t.align]),(0,l.useEffect)(()=>{v&&b&&v.commands.focus("end")},[v,b]),(0,l.useEffect)(()=>{if(v){let e=document.querySelector('[data-block-id="'.concat(t.id,'"] .ProseMirror'));e&&(e.__editor=v)}},[v,t.id]),v)?(0,a.jsx)("div",{className:"prose max-w-none focus-within:outline-none ".concat("uppercase"===t.textCase?"uppercase":""," \n        ").concat("lowercase"===t.textCase?"lowercase":""," \n        ").concat("capitalize"===t.textCase?"capitalize":""),style:{paddingLeft:"".concat(2*t.indent,"rem"),transition:"all 0.2s ease-in-out"},"data-block-id":t.id,children:(0,a.jsx)(s.kg,{editor:v})}):null};var b=r(29),y=r.n(b);let v=e=>{let{block:t,onUpdate:r}=e,[n,s]=(0,l.useState)(!1),i=e=>e.replace(/\\left\s*{/g,"\\left\\{").replace(/\\right\s*}/g,"\\right\\}").replace(/\\left\s*\(/g,"\\left(").replace(/\\right\s*\)/g,"\\right)").replace(/\\left\s*\[/g,"\\left[").replace(/\\right\s*\]/g,"\\right]").replace(/\\overset\s*{/g,"\\overset{").replace(/\\overset\s*{\\overline}/g,"\\overline").replace(/\\overset\s*{\\cdot}/g,"\\dot").replace(/exp\s*⁡/g,"\\exp").replace(/\\alpha\s+\\overset/g,"\\alpha\\overset").replace(/\\beta\s+\\right/g,"\\beta\\right").replace(/\\sigma\s+\\alpha/g,"\\sigma\\alpha").replace(/\s+/g," ").trim(),{formula:o,number:c}=(e=>{if(e.includes("#")){let[t,r]=e.split("#").map(e=>e.trim()),a=r.replace(/[()]/g,"").trim();return{formula:i(t),number:a}}return{formula:i(e),number:null}})(t.content);return(0,a.jsx)("div",{className:"w-full",children:n?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("textarea",{value:t.content,onChange:e=>{r({content:e.target.value})},className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введите LaTeX формулу",rows:2,autoFocus:!0,onBlur:()=>s(!1),onKeyDown:e=>{"Enter"===e.key&&e.shiftKey&&(e.preventDefault(),s(!1))}}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Нажмите Shift + Enter или кликните вне поля для сохранения"})]}):(0,a.jsxs)("div",{onClick:()=>s(!0),className:"jsx-345c0dec742c450c formula-container cursor-pointer hover:bg-gray-50/50 transition-colors rounded p-4",children:[(0,a.jsx)(y(),{id:"345c0dec742c450c",children:".formula-container{display:grid;grid-template-columns:1fr auto;gap:2rem;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;width:100%;overflow:hidden}.formula-container .formula{overflow-x:auto;overflow-y:hidden;margin:0;scrollbar-width:none;-ms-overflow-style:none}.formula-container .formula::-webkit-scrollbar{display:none}.formula-container .formula .katex-display{margin:0;padding:0}.formula-container .formula .katex-display>.katex{white-space:nowrap}.formula-container .number{font-size:1.2em;color:#333;white-space:nowrap}"}),(0,a.jsx)("div",{className:"jsx-345c0dec742c450c formula",children:(0,a.jsx)(m.BlockMath,{math:o||" "})}),c&&(0,a.jsxs)("div",{className:"jsx-345c0dec742c450c number",children:["(",c,")"]})]})})};var j=r(3145);let N=e=>{let{block:t,onUpdate:r}=e,l=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&r({src:URL.createObjectURL(a)})};return(0,a.jsxs)("div",{className:"w-full space-y-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:l,className:"w-full p-2"}),t.src&&(0,a.jsx)("div",{className:"relative w-full h-[300px]",children:(0,a.jsx)(j.default,{src:t.src,alt:"Uploaded image",fill:!0,className:"object-contain"})})]})};var w=r(2744);let C=e=>{let{blocks:t}=e,[r,n]=(0,l.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>n(!r),className:"bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full shadow-lg transition-all hover:scale-105",title:"Показать JSON",children:(0,a.jsx)(w.xoN,{className:"w-6 h-6"})}),r&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Предпросмотр JSON"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{let e=JSON.stringify(t,null,2);navigator.clipboard.writeText(e)},className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors",children:"Копировать"}),(0,a.jsx)("button",{onClick:()=>n(!1),className:"px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded transition-colors",children:"Закрыть"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-4",children:(0,a.jsx)("pre",{className:"bg-gray-50 p-4 rounded-lg text-sm font-mono whitespace-pre-wrap",children:JSON.stringify(t,null,2)})})]})})]})},k=e=>e.replace(/\\left\s*{/g,"\\left\\{").replace(/\\right\s*}/g,"\\right\\}").replace(/\\left\s*\(/g,"\\left(").replace(/\\right\s*\)/g,"\\right)").replace(/\\left\s*\[/g,"\\left[").replace(/\\right\s*\]/g,"\\right]").replace(/\\overset\s*{/g,"\\overset{").replace(/\\overset\s*{\\overline}/g,"\\overline").replace(/\\overset\s*{\\cdot}/g,"\\dot").replace(/exp\s*⁡/g,"\\exp").replace(/\\alpha\s+\\overset/g,"\\alpha\\overset").replace(/\\beta\s+\\right/g,"\\beta\\right").replace(/\\sigma\s+\\alpha/g,"\\sigma\\alpha").replace(/\s+/g," ").trim(),S=e=>{let{blocks:t}=e,r=e=>{switch(e.type){case"H1":return(0,a.jsx)("h1",{className:"text-4xl font-bold mb-6 mt-8",dangerouslySetInnerHTML:{__html:e.content||""}});case"H2":return(0,a.jsx)("h2",{className:"text-3xl font-bold mb-4 mt-6",dangerouslySetInnerHTML:{__html:e.content||""}});case"H3":return(0,a.jsx)("h3",{className:"text-2xl font-bold mb-3 mt-5",dangerouslySetInnerHTML:{__html:e.content||""}});case"P":let t=e.content.split(/(\$.*?\$)/g);return(0,a.jsx)("p",{className:"text-lg mb-4 leading-relaxed",children:t.map((e,t)=>{if(!(e.startsWith("$")&&e.endsWith("$")))return(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e}},t);{let r=k(e.slice(1,-1));return(0,a.jsx)(m.InlineMath,{math:r,errorColor:"#e53e3e",renderError:t=>(console.error("KaTeX error:",t),(0,a.jsxs)("span",{style:{color:"#e53e3e",cursor:"help",borderBottom:"1px dotted #e53e3e"},title:t.message,children:["$",e.slice(1,-1),"$"]}))},t)}})});case"CAPTION":return(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4 italic",dangerouslySetInnerHTML:{__html:e.content||""}});case"IMAGE":return e.src?(0,a.jsx)("div",{className:"my-6",children:(0,a.jsx)("div",{className:"relative w-full h-[400px]",children:(0,a.jsx)(j.default,{src:e.src,alt:"Article image",fill:!0,className:"object-contain"})})}):null;case"FORMULA":let[r,l]=(e.content||"").split("#").map(e=>e.trim()),n=null==l?void 0:l.replace(/[()]/g,"").trim();return(0,a.jsxs)("div",{className:"my-6 flex justify-center items-center gap-4",children:[(0,a.jsx)(m.BlockMath,{math:k(r),errorColor:"#e53e3e",renderError:e=>(console.error("KaTeX error:",e),(0,a.jsx)("div",{style:{color:"#e53e3e",cursor:"help",borderBottom:"1px dotted #e53e3e",padding:"1rem"},title:e.message,children:r}))}),n&&(0,a.jsxs)("div",{className:"text-lg text-gray-600",children:["(",n,")"]})]});default:return null}};return(0,a.jsx)("article",{className:"max-w-4xl mx-auto px-6 py-8 bg-white",children:t.map(e=>(0,a.jsx)("div",{className:e.align?"text-".concat(e.align):"",style:{paddingLeft:"".concat(2*e.indent,"rem"),transition:"padding-left 0.2s ease-in-out"},children:r(e)},e.id))})};var E=r(4657),A=r.n(E);function T(e){let t=e.tagName.toLowerCase();switch(t){case"mi":return{type:"variable",value:e.textContent||"",children:[]};case"mn":return{type:"number",value:e.textContent||"",children:[]};case"mo":return{type:"operator",value:e.textContent||"",children:[]};case"mfenced":let r=e.getAttribute("open")||"(",a=e.getAttribute("close")||")";return{type:"group",value:"fenced",children:[{type:"operator",value:r,children:[],attributes:{fence:"left",fenceType:r}},...Array.from(e.children).map(T),{type:"operator",value:a,children:[],attributes:{fence:"right",fenceType:a}}]};case"msub":let[l,n]=e.children;return{type:"subscript",value:"",children:[T(l),{...T(n),attributes:{position:"sub"}}]};case"msup":let[s,i]=e.children;return{type:"superscript",value:"",children:[T(s),{...T(i),attributes:{position:"super"}}]};case"mover":let[o,c]=e.children,d=c.textContent||"";return{type:"decoration",value:("‾"===d?"overline":"˙"===d?"dot":void 0)||"",children:[T(o)]};case"mrow":return{type:"group",value:"row",children:Array.from(e.children).map(T)};default:return console.warn("Неизвестный тег MathML: ".concat(t)),{type:"group",value:"unknown",children:Array.from(e.children).map(T)}}}function L(e){switch(e.type){case"variable":return({α:"\\alpha",β:"\\beta",θ:"\\theta",μ:"\\mu",σ:"\\sigma"})[e.value]||e.value;case"number":return e.value;case"operator":var t;if(null===(t=e.attributes)||void 0===t?void 0:t.fence)return"left"===e.attributes.fence?"\\left"+e.value:"\\right"+e.value;return e.value;case"group":return e.children.map(L).join(" ");case"subscript":return"".concat(L(e.children[0]),"_{").concat(L(e.children[1]),"}");case"superscript":return"".concat(L(e.children[0]),"^{").concat(L(e.children[1]),"}");case"decoration":let r=L(e.children[0]);switch(e.value){case"overline":return"\\overset{\\overline}{".concat(r,"}");case"dot":return"\\overset{\\cdot}{".concat(r,"}");default:return r}default:return e.children.map(L).join(" ")}}let I={styleMap:["p[style-name='Section Title'] => h1:fresh","p[style-name='Subsection Title'] => h2:fresh"]};function M(e){try{return function(e){let t=new DOMParser().parseFromString(e,"text/xml").querySelector("math");return t?null!==t.querySelector("mtable")?Array.from(t.querySelectorAll("mtr")).map(e=>{let t=e.querySelector("mtd");return t?L(T(t)):""}).filter(e=>e).join(" \\\\ "):L(T(t)):(console.error("Не найден элемент math"),e)}(e)}catch(t){return console.error("Error converting MathML to LaTeX:",t),e}}async function H(e){let t=new DOMParser().parseFromString(e,"text/html"),r=[];try{let e=Array.from(t.body.children);for(let t=0;t<e.length;t++){let a=e[t],l=a.tagName.toLowerCase();if(["h1","h2","h3"].includes(l)){r.push({type:l.toUpperCase(),content:a.innerHTML,indent:0,modified:new Date().toISOString(),id:"".concat(l,"-").concat(t)});continue}if("img"===l){a.src&&r.push({type:"IMAGE",variant:"1",images:[],src:a.src,indent:0,modified:new Date().toISOString(),id:"img-".concat(t)});continue}if("p"===l){let e=function e(t){let r=[];if("img"===t.tagName.toLowerCase())return r.push(t),r;for(let a of Array.from(t.children))r.push(...e(a));return r}(a);if(e.length>0){let l=a.innerHTML;for(let a=0;a<e.length;a++){let n=e[a],s=n.outerHTML,i=l.split(s);i[0].trim()&&r.push({type:"P",content:i[0].trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-").concat(a)}),n.src&&r.push({type:"IMAGE",variant:"1",images:[],src:n.src,indent:0,modified:new Date().toISOString(),id:"img-".concat(t,"-").concat(a)}),l=i[1]||""}l.trim()&&r.push({type:"P",content:l.trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-final")})}else{let e=a.innerHTML,l=/<math[^>]*>[\s\S]*?<\/math>/g,n=e.match(l);if(n){let a=e,l=!1;for(let e of n)if(e.includes('display="block"')||e.includes('mode="display"')||e.includes('class="formula-block"')||e.includes('style="display:block"')){let n=a.split(e);for(let a of(n[0].trim()&&r.push({type:"P",content:n[0].trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-").concat(r.length)}),M(e).split("\\\\").map(e=>e.trim())))a&&r.push({type:"FORMULA",source:"latex",content:a,inline:!1,indent:0,modified:new Date().toISOString(),id:"formula-".concat(t,"-").concat(r.length)});a=n[1]||"",l=!0}else a=a.replace(e,"$".concat(M(e),"$"));a.trim()&&!l&&r.push({type:"P",content:a.trim(),indent:0,modified:new Date().toISOString(),id:"p-".concat(t,"-").concat(r.length)})}else r.push({type:"P",content:e,indent:0,modified:new Date().toISOString(),id:"p-".concat(t)})}}}return r}catch(e){throw console.error("Error parsing HTML:",e),Error("Failed to parse document content: "+(e instanceof Error?e.message:String(e)))}}async function O(e){try{let t=await A().convertToHtml({arrayBuffer:e,...I});if(!t.value)throw Error("Empty document content");return await H(t.value)}catch(e){throw console.error("Error converting DOCX:",e),Error("Failed to process document: "+(e instanceof Error?e.message:String(e)))}}let D=e=>{let{onImport:t}=e,[r,n]=(0,l.useState)(!1),[s,i]=(0,l.useState)(null),[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(0),p=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&await m(r)},m=async e=>{n(!0),i(null),u(0);try{let r=[],a=setInterval(()=>{u(e=>Math.min(e+10,90))},100);if(e.name.endsWith(".docx")){let t=await e.arrayBuffer();r=await O(t)}else if(e.name.endsWith(".tex")){let t=await e.text();r=function(e){let t=[],r="",a=!1,l=!1,n="";for(let s of e.split("\n")){if(s.trim().startsWith("$$")&&!a){r.trim()&&t.push({type:"P",content:r.trim()}),a=!0,r="";continue}if(s.trim().endsWith("$$")&&a){a=!1;let e=r.trim();t.push({type:"FORMULA",source:"latex",content:e,latex:e}),r="";continue}if(s.trim().startsWith("\\begin{equation}")){l=!0;let e=s.match(/\\label\{(.*?)\}/);n=e?e[1]:"";continue}if(s.trim().endsWith("\\end{equation}")){l=!1,t.push({type:"FORMULA",source:"latex",content:r.trim(),latex:r.trim(),ref:n}),r="";continue}if(a||l){r+=s.trim()+" ";continue}if(!a&&!l){let e,t=s,r=/\$(.*?)\$/g;for(;null!==(e=r.exec(s));){let r=e[1];t=t.replace(e[0],'<span class="inline-formula" data-latex="'.concat(r,'">$').concat(r,"$</span>"))}s=t}r+=s+"\n"}return r.trim()&&t.push({type:"P",content:r.trim()}),t}(t)}else throw Error("Поддерживаются только .docx и .tex файлы");clearInterval(a),u(100),t(r),setTimeout(()=>{u(0),n(!1)},1e3)}catch(e){i(e instanceof Error?e.message:"Ошибка при импорте файла"),n(!1),u(0)}},g=async e=>{e.preventDefault(),c(!1);let t=e.dataTransfer.files[0];t&&await m(t)};return(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"relative flex items-center justify-center w-full",onDragOver:e=>{e.preventDefault(),c(!0)},onDragLeave:e=>{e.preventDefault(),c(!1)},onDrop:g,children:(0,a.jsxs)("label",{htmlFor:"dropzone-file",className:"\n            flex items-center justify-center w-full h-32 \n            border-2 border-dashed rounded-lg cursor-pointer \n            transition-all duration-200 ease-in-out\n            ".concat(o?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-blue-400","\n            ").concat(r?"bg-gray-50":"bg-white hover:bg-gray-50","\n            ").concat(s?"border-red-300 bg-red-50":"","\n          "),children:[(0,a.jsx)("div",{className:"flex items-center gap-3 px-4",children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Загрузка файла..."}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[d,"%"]})]})]}):s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.vVM,{className:"w-8 h-8 text-red-500"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-red-700",children:"Ошибка загрузки"}),(0,a.jsx)("span",{className:"text-xs text-red-500",children:s})]})]}):100===d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.ZSR,{className:"w-8 h-8 text-green-500"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-green-700",children:"Файл загружен"}),(0,a.jsx)("span",{className:"text-xs text-green-500",children:"Документ успешно импортирован"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Ap8,{className:"w-8 h-8 text-gray-400 group-hover:text-blue-500 transition-colors"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Выберите файл или перетащите его сюда"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"DOCX или TEX"})]})]})}),(0,a.jsx)("input",{id:"dropzone-file",type:"file",className:"hidden",accept:".docx,.tex",onChange:p,disabled:r})]})}),d>0&&d<100&&(0,a.jsx)("div",{className:"mt-2 h-1 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-200 ease-out",style:{width:"".concat(d,"%")}})})]})};r(353),r(8927);var F=r(795),P=r(3662),U=r(9892);let R=e=>{let{block:t,onDelete:r,onAdd:n,blockControls:s,children:i}=e,[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),p=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let m=[{type:"H1",icon:w.SQS,label:"Заголовок"},{type:"P",icon:w.BAW,label:"Параграф"},{type:"FORMULA",icon:w.l0y,label:"Формула"},{type:"IMAGE",icon:w.e0s,label:"Изображение"}];return(0,a.jsxs)("div",{className:"group/block relative",children:[(0,a.jsx)("div",{className:"relative",children:i}),(0,a.jsx)("div",{className:"absolute right-0 top-0 opacity-0 group-hover/block:opacity-100 transition-opacity duration-200",children:(0,a.jsxs)("div",{className:"relative",ref:p,children:[(0,a.jsx)("button",{onClick:()=>c(!o),className:"p-1.5 rounded-md hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(w.rgS,{className:"w-4 h-4"})}),o&&(0,a.jsxs)("div",{className:"absolute right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 min-w-[180px] z-50",children:[(0,a.jsx)("div",{className:"px-3 py-1.5 text-xs font-medium text-gray-500 border-b border-gray-100",children:t.type}),(0,a.jsxs)("button",{onClick:()=>u(!d),className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-gray-50 text-gray-700 text-sm",children:[(0,a.jsx)(w.xoN,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:d?"Скрыть JSON":"Показать JSON"})]}),(0,a.jsxs)("button",{onClick:()=>{r(),c(!1)},className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-red-50 text-red-600 text-sm",children:[(0,a.jsx)(w.ZkW,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Удалить блок"})]}),(0,a.jsxs)("div",{className:"border-t border-gray-100 mt-1 pt-1",children:[(0,a.jsx)("div",{className:"px-3 py-1.5 text-xs font-medium text-gray-500",children:"Добавить блок"}),m.map(e=>(0,a.jsxs)("button",{onClick:()=>{n(e.type),c(!1)},className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-gray-50 text-gray-700 text-sm",children:[(0,a.jsx)(e.icon,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:e.label})]},e.type))]})]})]})}),d&&(0,a.jsx)("div",{className:"mt-2 px-3 py-2 bg-gray-50 rounded-md border border-gray-200 font-mono text-xs text-gray-600 overflow-x-auto",children:(0,a.jsx)("pre",{children:JSON.stringify(t,null,2)})}),s&&(0,a.jsx)("div",{className:"absolute right-8 top-0 opacity-0 group-hover/block:opacity-100 transition-opacity duration-200",children:s})]})},$=e=>{let{block:t,isSelected:r,onSelect:n,onUpdate:s,onDelete:i,onAdd:o,activeFormats:c,onActiveFormatsChange:d,onEnterPress:u}=e,[p,m]=(0,l.useState)(!1),{attributes:g,listeners:x,setNodeRef:h,transform:b,transition:y,isDragging:j}=(0,P.nB)({id:t.id}),C={transform:U.ux.Transform.toString(b),transition:y,opacity:j?.5:1};return(0,a.jsxs)("div",{ref:h,style:C,className:"relative group ".concat((()=>{switch(t.type){case"H1":return"mb-6";case"H2":return"mb-4 mt-6";case"H3":return"mb-3 mt-4";case"P":return"mb-3";case"CAPTION":return"mb-4";case"IMAGE":case"FORMULA":return"my-6";default:return""}})()," transition-all duration-200"),onClick:n,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none transition-opacity duration-200 \n          ".concat(r||p?"opacity-100":"opacity-0","\n          ").concat(r?"bg-blue-50/30 ring-1 ring-blue-200":"bg-gray-50/30")}),(0,a.jsx)("div",{...g,...x,className:"absolute left-0 top-1/2 -translate-x-[calc(100%+4px)] -translate-y-1/2 \n          transition-opacity duration-200 ".concat(r||p?"opacity-100":"opacity-0"),children:(0,a.jsx)("div",{className:"p-1.5 cursor-move hover:bg-blue-100 rounded-md transition-colors",children:(0,a.jsx)(w.iVq,{className:"w-4 h-4 text-blue-400"})})}),(0,a.jsx)("div",{className:"relative ".concat(r?"z-10":""),children:(0,a.jsx)(R,{block:t,onUpdate:s,onDelete:i,onAdd:o,children:(()=>{switch(t.type){case"H1":case"H2":case"H3":case"P":case"CAPTION":return(0,a.jsx)(f,{block:t,onUpdate:s,onDelete:i,onAdd:o,activeFormats:r?c:void 0,onActiveFormatsChange:d,onEnterPress:u,shouldFocus:t.$new});case"FORMULA":return(0,a.jsx)(v,{block:t,onUpdate:s});case"IMAGE":return(0,a.jsx)(N,{block:t,onUpdate:s});default:return null}})()})})]})};var _=r(1140),z=r(4154),B=r(5168);let W=e=>{let{onBlockTypeChange:t,onTextAlignChange:r,onTextCaseChange:n,onFormatClick:s,onClearFormat:i,onListClick:o,onFormulaClick:c,onIndentChange:d,canIndentLeft:u,canIndentRight:p,canUndo:m,canRedo:g,onUndo:x,onRedo:h,activeFormats:f}=e,[b,y]=(0,l.useState)(!1),v=[{icon:_.Cxy,label:"Заголовок",type:"H1"},{icon:_.hH4,label:"Подзаголовок",type:"H2"},{icon:_.CGP,label:"Малый заголовок",type:"H3"},{icon:_.OWN,label:"Параграф",type:"P"},{icon:z.Z24,label:"Подпись",type:"CAPTION"}],j=_.OWN;return(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-white border border-gray-200 rounded-lg p-1.5 shadow-sm",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>y(!b),className:"flex items-center gap-1 px-2 py-1.5 rounded hover:bg-gray-100 text-gray-700",children:[(0,a.jsx)(j,{className:"w-4 h-4"}),(0,a.jsx)(w.Ix0,{className:"w-4 h-4"})]}),b&&(0,a.jsx)("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 min-w-[160px] z-50",children:v.map(e=>(0,a.jsxs)("button",{onClick:()=>{t(e.type),y(!1)},className:"flex items-center gap-2 w-full px-3 py-2 hover:bg-gray-50 text-gray-700 text-sm",children:[(0,a.jsx)(e.icon,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:e.label})]},e.type))})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>s("bold"),className:"p-1.5 rounded hover:bg-gray-100 ".concat((null==f?void 0:f.bold)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Жирный (Ctrl+B)",children:(0,a.jsx)(w.fO_,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>s("italic"),className:"p-1.5 rounded hover:bg-gray-100 ".concat((null==f?void 0:f.italic)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Курсив (Ctrl+I)",children:(0,a.jsx)(w.W0y,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>s("underline"),className:"p-1.5 rounded hover:bg-gray-100 ".concat((null==f?void 0:f.underline)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Подчеркнутый (Ctrl+U)",children:(0,a.jsx)(w.$kk,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>s("superscript"),className:"p-1.5 rounded hover:bg-gray-100 ".concat((null==f?void 0:f.superscript)?"bg-blue-50 text-blue-600":"text-gray-700"),title:"Верхний индекс",children:(0,a.jsx)(w._Jf,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:i,className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Очистить форматирование (Ctrl+\\)",children:(0,a.jsx)(w.w7s,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>r("left"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"По левому краю",children:(0,a.jsx)(w.eq2,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>r("center"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"По центру",children:(0,a.jsx)(w.wWG,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>r("right"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"По правому краю",children:(0,a.jsx)(w.rmK,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>o("bullet"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Маркированный список",children:(0,a.jsx)(w.f_H,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>o("number"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Нумерованный список",children:(0,a.jsx)(w.C4F,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsx)("button",{onClick:c,className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Вставить формулу",children:(0,a.jsx)(w.l0y,{className:"w-4 h-4"})})}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:x,disabled:!m,className:"p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Отменить (Ctrl+Z)",children:(0,a.jsx)(w.TsG,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:h,disabled:!g,className:"p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Повторить (Ctrl+Shift+Z)",children:(0,a.jsx)(w.VUZ,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>n("uppercase"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"ВЕРХНИЙ РЕГИСТР",children:(0,a.jsx)(B.ZfG,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>n("lowercase"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"нижний регистр",children:(0,a.jsx)(B.eSD,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>n("capitalize"),className:"p-1.5 rounded hover:bg-gray-100 text-gray-700",title:"Каждое Слово С Заглавной",children:(0,a.jsx)(B.sDt,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>d("left"),disabled:!u,className:"p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Уменьшить отступ",children:(0,a.jsx)(w.IXt,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>d("right"),disabled:!p,className:"p-1.5 rounded hover:bg-gray-100 text-gray-700 disabled:opacity-40",title:"Увеличить отступ",children:(0,a.jsx)(w.CYn,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-200"})]})},q=e=>{let{blockId:t,...r}=e,[n,s]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(t)s(!0);else{let e=setTimeout(()=>s(!1),200);return()=>clearTimeout(e)}},[t]),(0,a.jsx)("div",{className:"\n        sticky top-0 z-50 transition-all duration-200 ease-in-out\n        ".concat(n?"opacity-100 translate-y-0":"opacity-0 -translate-y-4","\n      "),children:(0,a.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-screen-xl mx-auto px-4",children:(0,a.jsx)(W,{...r})})})})},G=e=>{var t,r;let{initialData:s,onChange:i}=e,[o,c]=(0,l.useState)((null==s?void 0:s.blocks)||[]),[d,u]=(0,l.useState)(null),[p,m]=(0,l.useState)(null),[g,x]=(0,l.useState)({past:[],present:[],future:[]}),[h,f]=(0,l.useState)({bold:!1,italic:!1,underline:!1,superscript:!1}),[b,y]=(0,l.useState)(!1),v=(0,F.Dy)((0,F.VT)(F.we),(0,F.VT)(F.Lg,{coordinateGetter:P.is})),j=(0,l.useCallback)(e=>{x(t=>({past:[...t.past,t.present],present:e,future:[]})),c(e),null==i||i({blocks:e})},[o,i]),N=e=>{let t={id:(0,n.x0)(10),indent:0,type:e,modified:new Date().toISOString(),$new:!0};return"H1"===e||"H2"===e||"H3"===e||"P"===e||"CAPTION"===e?{...t,type:e,content:""}:"FORMULA"===e?{...t,type:e,source:"latex",content:""}:"IMAGE"===e?{...t,type:e,variant:"1",images:[],src:""}:{...t,type:e}},k=(e,t)=>{let r;let a=N(e);if(t){let e=o.findIndex(e=>e.id===t);r=[...o.slice(0,e+1),a,...o.slice(e+1)]}else r=[...o,a];j(r),u(a.id),m(a.id)},E=(e,t)=>{j(o.map(r=>r.id!==e?r:{...r,...t,modified:new Date().toISOString()}))},A=e=>{j(o.filter(t=>t.id!==e))},T=e=>{f(e)};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(q,{blockId:d,onBlockTypeChange:e=>{d&&E(d,{type:e})},onTextAlignChange:e=>{d&&E(d,{align:e})},onTextCaseChange:e=>{if(!d)return;let t=o.find(e=>e.id===d);t&&"content"in t&&E(d,{textCase:e})},onFormatClick:e=>{let t=o.find(e=>e.id===d);t&&"content"in t&&f(t=>({...t,[e]:!t[e]}))},onClearFormat:()=>{let e=o.find(e=>e.id===d);e&&"content"in e&&(f({bold:!1,italic:!1,underline:!1,superscript:!1}),E(e.id,{align:"left",textCase:"normal"}))},onListClick:e=>{let t=o.find(e=>e.id===d);t&&"content"in t&&("H1"===t.type||"H2"===t.type||"H3"===t.type||"P"===t.type||"CAPTION"===t.type)&&(t.listType===e?E(t.id,{listType:void 0}):E(t.id,{listType:e}))},onFormulaClick:()=>{let e=o.find(e=>e.id===d);if(!e||!("content"in e))return;if("H1"===e.type||"H2"===e.type||"H3"===e.type||"P"===e.type||"CAPTION"===e.type){let e=document.querySelector('[data-block-id="'.concat(d,'"] .ProseMirror')),t=null==e?void 0:e.__editor;if(t){let{from:e,to:r}=t.state.selection,a=t.state.doc.textBetween(e,r);a?t.chain().focus().setFormula(a).run():t.chain().focus().setFormula("").run();return}}let t={id:(0,n.x0)(10),type:"FORMULA",source:"latex",content:"",indent:0,modified:new Date().toISOString(),$new:!0},r=o.findIndex(e=>e.id===d);j([...o.slice(0,r+1),t,...o.slice(r+1)]),u(t.id)},onIndentChange:e=>{let t=o.find(e=>e.id===d);if(!t)return;let r=t.indent||0,a=r;"right"===e&&r<4?a=r+1:"left"===e&&r>0&&(a=r-1),a!==r&&E(t.id,{indent:a})},canIndentLeft:!!d&&((null===(t=o.find(e=>e.id===d))||void 0===t?void 0:t.indent)||0)>0,canIndentRight:!!d&&4>((null===(r=o.find(e=>e.id===d))||void 0===r?void 0:r.indent)||0),canUndo:g.past.length>0,canRedo:g.future.length>0,onUndo:()=>{if(0===g.past.length)return;let e=g.past[g.past.length-1];x({past:g.past.slice(0,g.past.length-1),present:e,future:[g.present,...g.future]}),c(e)},onRedo:()=>{if(0===g.future.length)return;let e=g.future[0],t=g.future.slice(1);x({past:[...g.past,g.present],present:e,future:t}),c(e)},activeFormats:h}),(0,a.jsxs)("div",{className:"max-w-screen-xl mx-auto",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4 px-4",children:(0,a.jsx)(D,{onImport:e=>{j([...o,...e.map(e=>(e.type,{...e,id:(0,n.x0)(10),modified:new Date().toISOString(),indent:0}))])}})}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm",children:0===o.length?(0,a.jsx)("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"text-gray-500",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Начните создавать статью"}),(0,a.jsx)("p",{className:"text-sm mb-4",children:"Выберите тип блока, чтобы начать"}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>k("H1"),className:"flex items-center gap-2 px-4 py-2 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all group",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-gray-400 group-hover:text-blue-500",children:"H1"}),(0,a.jsx)("span",{className:"text-gray-500 group-hover:text-blue-600",children:"Заголовок"})]}),(0,a.jsx)("span",{className:"text-2xl font-bold text-gray-400",children:"∨"}),(0,a.jsxs)("button",{onClick:()=>k("P"),className:"flex items-center gap-2 px-4 py-2 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all group",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-gray-400 group-hover:text-blue-500",children:"\xb6"}),(0,a.jsx)("span",{className:"text-gray-500 group-hover:text-blue-600",children:"Параграф"})]})]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-400",children:"Используйте панель инструментов для форматирования"})]})}):(0,a.jsx)(F.LB,{sensors:v,collisionDetection:F.pE,onDragEnd:e=>{let{active:t,over:r}=e;r&&t.id!==r.id&&c(e=>{let a=e.findIndex(e=>e.id===t.id),l=e.findIndex(e=>e.id===r.id),n=(0,P.Rp)(e,a,l);return null==i||i({blocks:n}),n})},children:(0,a.jsx)(P.Fo,{items:o.map(e=>e.id),strategy:P.qw,children:o.map(e=>(0,a.jsx)($,{block:e,isSelected:d===e.id,onSelect:()=>u(e.id),onUpdate:t=>E(e.id,t),onDelete:()=>A(e.id),onAdd:t=>k(t,e.id),activeFormats:d===e.id?h:void 0,onActiveFormatsChange:T,onEnterPress:()=>k("P",e.id)},e.id))})})})})]}),(0,a.jsxs)("div",{className:"fixed bottom-4 right-4 z-50 flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>y(!0),className:"bg-green-500 hover:bg-green-600 text-white p-3 rounded-full shadow-lg transition-all hover:scale-105",title:"Предпросмотр статьи",children:(0,a.jsx)(w.Sbz,{className:"w-6 h-6"})}),(0,a.jsx)(C,{blocks:o})]}),b&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center p-4 z-50 overflow-auto",children:(0,a.jsxs)("div",{className:"bg-gray-100 rounded-lg shadow-xl w-full min-h-screen relative",children:[(0,a.jsx)("button",{onClick:()=>y(!1),className:"absolute top-4 right-4 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors",title:"Закрыть предпросмотр",children:(0,a.jsx)(w.FU5,{className:"w-6 h-6"})}),(0,a.jsx)(S,{blocks:o})]})})]})}}},function(e){e.O(0,[329,993,950,522,51,779,572,902,540,639,3,971,117,744],function(){return e(e.s=4971)}),_N_E=e.O()}]);